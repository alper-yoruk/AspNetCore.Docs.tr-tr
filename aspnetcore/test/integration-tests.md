---
title: ASP.NET Core tümleştirme testleri
author: rick-anderson
description: Tümleştirme testlerinin, bir uygulamanın bileşenlerinin, veritabanı, dosya sistemi ve ağ dahil olmak üzere altyapı düzeyinde doğru şekilde çalışmasını nasıl sağladığını öğrenin.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 07/14/2020
no-loc:
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: test/integration-tests
ms.openlocfilehash: c050665f630c0973abe6c9d08a4652597441639f
ms.sourcegitcommit: 384833762c614851db653b841cc09fbc944da463
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 07/17/2020
ms.locfileid: "86445287"
---
# <a name="integration-tests-in-aspnet-core"></a><span data-ttu-id="b7c11-103">ASP.NET Core tümleştirme testleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-103">Integration tests in ASP.NET Core</span></span>

<span data-ttu-id="b7c11-104">, [Javier Calvarro Nelson](https://github.com/javiercn), [Steve Smith](https://ardalis.com/)ve [Jos van der til](https://jvandertil.nl)</span><span class="sxs-lookup"><span data-stu-id="b7c11-104">By [Javier Calvarro Nelson](https://github.com/javiercn), [Steve Smith](https://ardalis.com/), and [Jos van der Til](https://jvandertil.nl)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="b7c11-105">Tümleştirme sınamaları, uygulamanın bileşenlerinin veritabanı, dosya sistemi ve ağ gibi destekleyici altyapısını içeren bir düzeyde doğru şekilde çalışmasını güvence altına alır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-105">Integration tests ensure that an app's components function correctly at a level that includes the app's supporting infrastructure, such as the database, file system, and network.</span></span> <span data-ttu-id="b7c11-106">ASP.NET Core, test Web ana bilgisayarı ve bellek içi test sunucusu olan bir birim testi çerçevesini kullanarak tümleştirme testlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-106">ASP.NET Core supports integration tests using a unit test framework with a test web host and an in-memory test server.</span></span>

<span data-ttu-id="b7c11-107">Bu konuda, birim testlerinin temel bir şekilde anlaşıldığı varsayılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-107">This topic assumes a basic understanding of unit tests.</span></span> <span data-ttu-id="b7c11-108">Test kavramları hakkında bilgi sahibi değilseniz, [.NET Core 'Da birim testine ve .NET Standard](/dotnet/core/testing/) konusuna ve bağlı içeriğine bakın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-108">If unfamiliar with test concepts, see the [Unit Testing in .NET Core and .NET Standard](/dotnet/core/testing/) topic and its linked content.</span></span>

<span data-ttu-id="b7c11-109">[Örnek kodu görüntüleme veya indirme](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) ([nasıl indirileceği](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b7c11-109">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="b7c11-110">Örnek uygulama bir Razor Sayfalar uygulamasıdır ve sayfaların temel olarak anlaşıldığını varsayar Razor .</span><span class="sxs-lookup"><span data-stu-id="b7c11-110">The sample app is a Razor Pages app and assumes a basic understanding of Razor Pages.</span></span> <span data-ttu-id="b7c11-111">Sayfalarla alışkın değilseniz Razor , aşağıdaki konulara bakın:</span><span class="sxs-lookup"><span data-stu-id="b7c11-111">If unfamiliar with Razor Pages, see the following topics:</span></span>

* <span data-ttu-id="b7c11-112">[Sayfalara giriş Razor](xref:razor-pages/index)</span><span class="sxs-lookup"><span data-stu-id="b7c11-112">[Introduction to Razor Pages](xref:razor-pages/index)</span></span>
* <span data-ttu-id="b7c11-113">[Sayfalarla çalışmaya başlama Razor](xref:tutorials/razor-pages/razor-pages-start)</span><span class="sxs-lookup"><span data-stu-id="b7c11-113">[Get started with Razor Pages](xref:tutorials/razor-pages/razor-pages-start)</span></span>
* <span data-ttu-id="b7c11-114">[RazorSayfalar birim testleri](xref:test/razor-pages-tests)</span><span class="sxs-lookup"><span data-stu-id="b7c11-114">[Razor Pages unit tests](xref:test/razor-pages-tests)</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-115">Maça 'Ları test etmek için, bir tarayıcıyı otomatikleştirebilen [Selenium](https://www.seleniumhq.org/)gibi bir araç öneririz.</span><span class="sxs-lookup"><span data-stu-id="b7c11-115">For testing SPAs, we recommended a tool such as [Selenium](https://www.seleniumhq.org/), which can automate a browser.</span></span>

## <a name="introduction-to-integration-tests"></a><span data-ttu-id="b7c11-116">Tümleştirme testlerine giriş</span><span class="sxs-lookup"><span data-stu-id="b7c11-116">Introduction to integration tests</span></span>

<span data-ttu-id="b7c11-117">Tümleştirme testleri, bir uygulamanın bileşenlerini [birim testlerinden](/dotnet/core/testing/)daha geniş bir düzeyde değerlendirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-117">Integration tests evaluate an app's components on a broader level than [unit tests](/dotnet/core/testing/).</span></span> <span data-ttu-id="b7c11-118">Birim testleri, ayrı sınıf yöntemleri gibi yalıtılmış yazılım bileşenlerini test etmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-118">Unit tests are used to test isolated software components, such as individual class methods.</span></span> <span data-ttu-id="b7c11-119">Tümleştirme testleri iki veya daha fazla uygulama bileşeninin beklenen bir sonuç üretmek için birlikte çalıştığını ve muhtemelen bir isteği tam olarak işlemek için gereken her bileşeni de dahil olduğunu onaylar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-119">Integration tests confirm that two or more app components work together to produce an expected result, possibly including every component required to fully process a request.</span></span>

<span data-ttu-id="b7c11-120">Bu geniş testler, uygulamanın altyapısını ve tüm çatısını test etmek için kullanılır, genellikle aşağıdaki bileşenler dahil:</span><span class="sxs-lookup"><span data-stu-id="b7c11-120">These broader tests are used to test the app's infrastructure and whole framework, often including the following components:</span></span>

* <span data-ttu-id="b7c11-121">Veritabanı</span><span class="sxs-lookup"><span data-stu-id="b7c11-121">Database</span></span>
* <span data-ttu-id="b7c11-122">Dosya sistemi</span><span class="sxs-lookup"><span data-stu-id="b7c11-122">File system</span></span>
* <span data-ttu-id="b7c11-123">Ağ gereçleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-123">Network appliances</span></span>
* <span data-ttu-id="b7c11-124">İstek-yanıt işlem hattı</span><span class="sxs-lookup"><span data-stu-id="b7c11-124">Request-response pipeline</span></span>

<span data-ttu-id="b7c11-125">Birim testleri, altyapı bileşenlerinin yerine, *Fakes* veya *sahte nesneler*olarak bilinen fabriccomponents bileşenlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-125">Unit tests use fabricated components, known as *fakes* or *mock objects*, in place of infrastructure components.</span></span>

<span data-ttu-id="b7c11-126">Birim testlerinin aksine, tümleştirme testleri:</span><span class="sxs-lookup"><span data-stu-id="b7c11-126">In contrast to unit tests, integration tests:</span></span>

* <span data-ttu-id="b7c11-127">Uygulamanın üretimde kullandığı gerçek bileşenleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-127">Use the actual components that the app uses in production.</span></span>
* <span data-ttu-id="b7c11-128">Daha fazla kod ve veri işleme gerektir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-128">Require more code and data processing.</span></span>
* <span data-ttu-id="b7c11-129">Çalıştırmak daha uzun sürer.</span><span class="sxs-lookup"><span data-stu-id="b7c11-129">Take longer to run.</span></span>

<span data-ttu-id="b7c11-130">Bu nedenle, tümleştirme testlerinin kullanımını en önemli altyapı senaryolarıyla sınırlayın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-130">Therefore, limit the use of integration tests to the most important infrastructure scenarios.</span></span> <span data-ttu-id="b7c11-131">Bir davranış, birim testi veya tümleştirme testi kullanılarak test edilebilir ise, birim testini seçin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-131">If a behavior can be tested using either a unit test or an integration test, choose the unit test.</span></span>

> [!TIP]
> <span data-ttu-id="b7c11-132">Veritabanları ve dosya sistemleriyle ilgili her olası veri ve dosya erişimi için tümleştirme testleri yazma.</span><span class="sxs-lookup"><span data-stu-id="b7c11-132">Don't write integration tests for every possible permutation of data and file access with databases and file systems.</span></span> <span data-ttu-id="b7c11-133">Bir uygulamadaki kaç yerde veritabanlarıyla ve dosya sistemleriyle etkileşime girdiğinize bakılmaksızın, bir dizi Read, Write, Update ve DELETE tümleştirme testi, genellikle veritabanı ve dosya sistemi bileşenlerinin yeterli şekilde test edilmesine sahip olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-133">Regardless of how many places across an app interact with databases and file systems, a focused set of read, write, update, and delete integration tests are usually capable of adequately testing database and file system components.</span></span> <span data-ttu-id="b7c11-134">Bu bileşenlerle etkileşime geçen Yöntem mantığının rutin testleri için birim testleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-134">Use unit tests for routine tests of method logic that interact with these components.</span></span> <span data-ttu-id="b7c11-135">Birim testlerinde, altyapı kullanımı ve moizler 'in kullanılması daha hızlı test yürütmesiyle sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-135">In unit tests, the use of infrastructure fakes/mocks result in faster test execution.</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-136">Tümleştirme testlerinin tartışmalarında, test edilen proje genellikle *test altındaki sistem*veya kısa IÇIN "sut" olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-136">In discussions of integration tests, the tested project is frequently called the *System Under Test*, or "SUT" for short.</span></span>
>
> <span data-ttu-id="b7c11-137">*Bu konu başlığı altında, sınanan ASP.NET Core uygulamasına başvurmak için "SUT" kullanılır.*</span><span class="sxs-lookup"><span data-stu-id="b7c11-137">*"SUT" is used throughout this topic to refer to the tested ASP.NET Core app.*</span></span>

## <a name="aspnet-core-integration-tests"></a><span data-ttu-id="b7c11-138">ASP.NET Core tümleştirme testleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-138">ASP.NET Core integration tests</span></span>

<span data-ttu-id="b7c11-139">ASP.NET Core tümleştirme testleri şunları gerektirir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-139">Integration tests in ASP.NET Core require the following:</span></span>

* <span data-ttu-id="b7c11-140">Testleri içermesi ve yürütmek için bir test projesi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-140">A test project is used to contain and execute the tests.</span></span> <span data-ttu-id="b7c11-141">Test projesinin SUT 'a bir başvurusu vardır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-141">The test project has a reference to the SUT.</span></span>
* <span data-ttu-id="b7c11-142">Test projesi SUT için bir test Web Konağı oluşturur ve SUT ile istekleri ve yanıtları işlemek için bir test sunucusu istemcisi kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-142">The test project creates a test web host for the SUT and uses a test server client to handle requests and responses with the SUT.</span></span>
* <span data-ttu-id="b7c11-143">Test Çalıştırıcısı, testleri yürütmek ve test sonuçlarını raporlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-143">A test runner is used to execute the tests and report the test results.</span></span>

<span data-ttu-id="b7c11-144">Tümleştirme testleri, olağan *düzenleme*, *hareket*ve *onaylama* testi adımlarını içeren bir olay dizisini izler:</span><span class="sxs-lookup"><span data-stu-id="b7c11-144">Integration tests follow a sequence of events that include the usual *Arrange*, *Act*, and *Assert* test steps:</span></span>

1. <span data-ttu-id="b7c11-145">SUT 'un web ana bilgisayarı yapılandırıldı.</span><span class="sxs-lookup"><span data-stu-id="b7c11-145">The SUT's web host is configured.</span></span>
1. <span data-ttu-id="b7c11-146">İstekleri uygulamaya göndermek için bir test sunucusu istemcisi oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-146">A test server client is created to submit requests to the app.</span></span>
1. <span data-ttu-id="b7c11-147">Testi *Düzenle* adımı yürütülür: test uygulaması bir istek hazırlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-147">The *Arrange* test step is executed: The test app prepares a request.</span></span>
1. <span data-ttu-id="b7c11-148">*Davran* test adımı yürütülür: istemci, isteği gönderir ve yanıtını alır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-148">The *Act* test step is executed: The client submits the request and receives the response.</span></span>
1. <span data-ttu-id="b7c11-149">*Onaylama* testi adımı yürütülür: *Gerçek* yanıt, *beklenen* bir yanıta bağlı olarak *başarılı* veya *başarısız* olarak onaylanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-149">The *Assert* test step is executed: The *actual* response is validated as a *pass* or *fail* based on an *expected* response.</span></span>
1. <span data-ttu-id="b7c11-150">İşlem, tüm testler yürütülene kadar devam eder.</span><span class="sxs-lookup"><span data-stu-id="b7c11-150">The process continues until all of the tests are executed.</span></span>
1. <span data-ttu-id="b7c11-151">Test sonuçları raporlanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-151">The test results are reported.</span></span>

<span data-ttu-id="b7c11-152">Genellikle, test Web ana bilgisayarı, test çalıştırmaları için uygulamanın normal web ana bilgisayarında farklı şekilde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-152">Usually, the test web host is configured differently than the app's normal web host for the test runs.</span></span> <span data-ttu-id="b7c11-153">Örneğin, testler için farklı bir veritabanı veya farklı uygulama ayarları kullanılıyor olabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-153">For example, a different database or different app settings might be used for the tests.</span></span>

<span data-ttu-id="b7c11-154">Test Web Konağı ve bellek içi test sunucusu ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)) gibi altyapı bileşenleri, [Microsoft. Aspnetcore. Mvc. Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paketi tarafından sağlanır veya yönetilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-154">Infrastructure components, such as the test web host and in-memory test server ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)), are provided or managed by the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package.</span></span> <span data-ttu-id="b7c11-155">Bu paketin kullanımı, test oluşturma ve yürütmeyi kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-155">Use of this package streamlines test creation and execution.</span></span>

<span data-ttu-id="b7c11-156">`Microsoft.AspNetCore.Mvc.Testing`Paket aşağıdaki görevleri gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-156">The `Microsoft.AspNetCore.Mvc.Testing` package handles the following tasks:</span></span>

* <span data-ttu-id="b7c11-157">Bağımlılıklar dosyasını (*. Deps*) sut 'den test projesinin *bin* dizinine kopyalar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-157">Copies the dependencies file (*.deps*) from the SUT into the test project's *bin* directory.</span></span>
* <span data-ttu-id="b7c11-158">, Testler yürütüldüğünde statik dosya ve sayfa/görünümlerin bulunması için [içerik kökünü](xref:fundamentals/index#content-root) sut 'nin proje köküne ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-158">Sets the [content root](xref:fundamentals/index#content-root) to the SUT's project root so that static files and pages/views are found when the tests are executed.</span></span>
* <span data-ttu-id="b7c11-159">, İle SUT önyükleyiciyi kolaylaştırmak için [Webapplicationfactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) sınıfını sağlar `TestServer` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-159">Provides the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) class to streamline bootstrapping the SUT with `TestServer`.</span></span>

<span data-ttu-id="b7c11-160">[Birim](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) testi belgeleri bir test projesi ve Test Çalıştırıcısı ayarlamayı ve testlerin ve test sınıflarının nasıl belirleneceğini gösteren testlerin ve önerilerin nasıl çalıştırılacağını gösteren ayrıntılı yönergelerle birlikte açıklanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-160">The [unit tests](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) documentation describes how to set up a test project and test runner, along with detailed instructions on how to run tests and recommendations for how to name tests and test classes.</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-161">Bir uygulama için test projesi oluştururken, birim testlerini tümleştirme testlerinden farklı projelere ayırın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-161">When creating a test project for an app, separate the unit tests from the integration tests into different projects.</span></span> <span data-ttu-id="b7c11-162">Bu, altyapı testi bileşenlerinin birim testlerine yanlışlıkla dahil olmamasını sağlamaya yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-162">This helps ensure that infrastructure testing components aren't accidentally included in the unit tests.</span></span> <span data-ttu-id="b7c11-163">Birim ve tümleştirme testlerinin ayrımı, hangi test kümesinin çalıştırılmasına da izin verir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-163">Separation of unit and integration tests also allows control over which set of tests are run.</span></span>

<span data-ttu-id="b7c11-164">Uygulamaların ve MVC uygulamalarının testleri için yapılandırma arasında neredeyse fark yoktur Razor .</span><span class="sxs-lookup"><span data-stu-id="b7c11-164">There's virtually no difference between the configuration for tests of Razor Pages apps and MVC apps.</span></span> <span data-ttu-id="b7c11-165">Tek fark testlerin adlandırılmasınlardır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-165">The only difference is in how the tests are named.</span></span> <span data-ttu-id="b7c11-166">Bir Razor Sayfalar uygulamasında sayfa uç noktalarının testleri genellikle sayfa modeli sınıfından sonra (örneğin, `IndexPageTests` Dizin sayfasına yönelik bileşen tümleştirmesini test etmek için) adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-166">In a Razor Pages app, tests of page endpoints are usually named after the page model class (for example, `IndexPageTests` to test component integration for the Index page).</span></span> <span data-ttu-id="b7c11-167">MVC uygulamasında, testler genellikle denetleyici sınıfları tarafından düzenlenir ve test ettikleri denetleyicilerde (örneğin, `HomeControllerTests` ana denetleyiciye yönelik bileşen tümleştirmesini test etmek için) adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-167">In an MVC app, tests are usually organized by controller classes and named after the controllers they test (for example, `HomeControllerTests` to test component integration for the Home controller).</span></span>

## <a name="test-app-prerequisites"></a><span data-ttu-id="b7c11-168">Test uygulaması önkoşulları</span><span class="sxs-lookup"><span data-stu-id="b7c11-168">Test app prerequisites</span></span>

<span data-ttu-id="b7c11-169">Test projesi şunları vermelidir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-169">The test project must:</span></span>

* <span data-ttu-id="b7c11-170">[Microsoft. AspNetCore. Mvc. Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paketine başvurun.</span><span class="sxs-lookup"><span data-stu-id="b7c11-170">Reference the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package.</span></span>
* <span data-ttu-id="b7c11-171">() Proje dosyasında Web SDK 'sını belirtin `<Project Sdk="Microsoft.NET.Sdk.Web">` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-171">Specify the Web SDK in the project file (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span></span>

<span data-ttu-id="b7c11-172">Bu Önkoşullar [örnek uygulamada](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/)görülebilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-172">These prerequisites can be seen in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/).</span></span> <span data-ttu-id="b7c11-173">*Testler/ Razor pagesproject. Tests/ Razor pagesproject. Tests. csproj* dosyasını inceleyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-173">Inspect the *tests/RazorPagesProject.Tests/RazorPagesProject.Tests.csproj* file.</span></span> <span data-ttu-id="b7c11-174">Örnek uygulama, [xUnit](https://xunit.github.io/) test çerçevesini ve [anglesharp](https://anglesharp.github.io/) Parser kitaplığını kullanır, bu nedenle örnek uygulama de şu şekilde başvurur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-174">The sample app uses the [xUnit](https://xunit.github.io/) test framework and the [AngleSharp](https://anglesharp.github.io/) parser library, so the sample app also references:</span></span>

* [<span data-ttu-id="b7c11-175">xUnit</span><span class="sxs-lookup"><span data-stu-id="b7c11-175">xunit</span></span>](https://www.nuget.org/packages/xunit)
* [<span data-ttu-id="b7c11-176">xUnit. Çalıştırıcısı. VisualStudio</span><span class="sxs-lookup"><span data-stu-id="b7c11-176">xunit.runner.visualstudio</span></span>](https://www.nuget.org/packages/xunit.runner.visualstudio)
* [<span data-ttu-id="b7c11-177">AngleSharp</span><span class="sxs-lookup"><span data-stu-id="b7c11-177">AngleSharp</span></span>](https://www.nuget.org/packages/AngleSharp)

<span data-ttu-id="b7c11-178">Entity Framework Core, testlerde de kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-178">Entity Framework Core is also used in the tests.</span></span> <span data-ttu-id="b7c11-179">Uygulama başvuru:</span><span class="sxs-lookup"><span data-stu-id="b7c11-179">The app references:</span></span>

* [<span data-ttu-id="b7c11-180">Microsoft. AspNetCore. Diagnostics. EntityFrameworkCore</span><span class="sxs-lookup"><span data-stu-id="b7c11-180">Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore)
* <span data-ttu-id="b7c11-181">[Microsoft. AspNetCore. Identity . EntityFrameworkCore](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.EntityFrameworkCore)</span><span class="sxs-lookup"><span data-stu-id="b7c11-181">[Microsoft.AspNetCore.Identity.EntityFrameworkCore](https://www.nuget.org/packages/Microsoft.AspNetCore.Identity.EntityFrameworkCore)</span></span>
* [<span data-ttu-id="b7c11-182">Microsoft. EntityFrameworkCore</span><span class="sxs-lookup"><span data-stu-id="b7c11-182">Microsoft.EntityFrameworkCore</span></span>](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore)
* [<span data-ttu-id="b7c11-183">Microsoft. EntityFrameworkCore. InMemory</span><span class="sxs-lookup"><span data-stu-id="b7c11-183">Microsoft.EntityFrameworkCore.InMemory</span></span>](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.InMemory)
* [<span data-ttu-id="b7c11-184">Microsoft. EntityFrameworkCore. Tools</span><span class="sxs-lookup"><span data-stu-id="b7c11-184">Microsoft.EntityFrameworkCore.Tools</span></span>](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Tools)

## <a name="sut-environment"></a><span data-ttu-id="b7c11-185">SUT ortamı</span><span class="sxs-lookup"><span data-stu-id="b7c11-185">SUT environment</span></span>

<span data-ttu-id="b7c11-186">SUT [ortamı](xref:fundamentals/environments) ayarlanmamışsa, ortam varsayılan olarak geliştirme olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-186">If the SUT's [environment](xref:fundamentals/environments) isn't set, the environment defaults to Development.</span></span>

## <a name="basic-tests-with-the-default-webapplicationfactory"></a><span data-ttu-id="b7c11-187">Varsayılan WebApplicationFactory ile temel testler</span><span class="sxs-lookup"><span data-stu-id="b7c11-187">Basic tests with the default WebApplicationFactory</span></span>

<span data-ttu-id="b7c11-188">[Webapplicationfactory \<TEntryPoint> ](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) , tümleştirme testleri için bir [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) oluşturmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-188">[WebApplicationFactory\<TEntryPoint>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) is used to create a [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) for the integration tests.</span></span> <span data-ttu-id="b7c11-189">`TEntryPoint`, genellikle sınıfının, SUT 'ın giriş noktası sınıfıdır `Startup` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-189">`TEntryPoint` is the entry point class of the SUT, usually the `Startup` class.</span></span>

<span data-ttu-id="b7c11-190">Test sınıfları sınıfı testlerin içerdiğini göstermek ve sınıftaki testler arasında paylaşılan nesne örnekleri sağlamak için bir *sınıf armatürü* arabirimi ([ıssfixture](https://xunit.github.io/docs/shared-context#class-fixture)) uygular.</span><span class="sxs-lookup"><span data-stu-id="b7c11-190">Test classes implement a *class fixture* interface ([IClassFixture](https://xunit.github.io/docs/shared-context#class-fixture)) to indicate the class contains tests and provide shared object instances across the tests in the class.</span></span>

<span data-ttu-id="b7c11-191">Aşağıdaki test sınıfı, `BasicTests` SUT 'yi önyüklemek `WebApplicationFactory` ve bir test yöntemine [HttpClient](/dotnet/api/system.net.http.httpclient) sağlamak için öğesini kullanır `Get_EndpointsReturnSuccessAndCorrectContentType` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-191">The following test class, `BasicTests`, uses the `WebApplicationFactory` to bootstrap the SUT and provide an [HttpClient](/dotnet/api/system.net.http.httpclient) to a test method, `Get_EndpointsReturnSuccessAndCorrectContentType`.</span></span> <span data-ttu-id="b7c11-192">Yöntemi, yanıt durum kodunun başarılı olup olmadığını denetler (200-299 aralığındaki durum kodları) ve `Content-Type` üst bilgi `text/html; charset=utf-8` birçok uygulama sayfasına yöneliktir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-192">The method checks if the response status code is successful (status codes in the range 200-299) and the `Content-Type` header is `text/html; charset=utf-8` for several app pages.</span></span>

<span data-ttu-id="b7c11-193">[Createclient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) , `HttpClient` yeniden yönlendirmeleri otomatik olarak izleyen ve tanımlama bilgilerini işleyen bir örneği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-193">[CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) creates an instance of `HttpClient` that automatically follows redirects and handles cookies.</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/BasicTests.cs?name=snippet1)]

<span data-ttu-id="b7c11-194">Varsayılan olarak, [GDPR onay ilkesi](xref:security/gdpr) etkinleştirildiğinde, önemli olmayan tanımlama bilgileri istekler arasında korunmaz.</span><span class="sxs-lookup"><span data-stu-id="b7c11-194">By default, non-essential cookies aren't preserved across requests when the [GDPR consent policy](xref:security/gdpr) is enabled.</span></span> <span data-ttu-id="b7c11-195">TempData sağlayıcısı tarafından kullanılanlar gibi, önemli olmayan tanımlama bilgilerini korumak için, bunları testlerinizde gerekli olarak işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-195">To preserve non-essential cookies, such as those used by the TempData provider, mark them as essential in your tests.</span></span> <span data-ttu-id="b7c11-196">Tanımlama bilgisini önemli olarak işaretleme hakkında yönergeler için bkz. [temel tanımlama bilgileri](xref:security/gdpr#essential-cookies).</span><span class="sxs-lookup"><span data-stu-id="b7c11-196">For instructions on marking a cookie as essential, see [Essential cookies](xref:security/gdpr#essential-cookies).</span></span>

## <a name="customize-webapplicationfactory"></a><span data-ttu-id="b7c11-197">WebApplicationFactory 'yi özelleştirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-197">Customize WebApplicationFactory</span></span>

<span data-ttu-id="b7c11-198">Web ana bilgisayar yapılandırması, öğesinden devralarak `WebApplicationFactory` bir veya daha fazla özel fabrika oluşturmak için test sınıflarından bağımsız olarak oluşturulabilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-198">Web host configuration can be created independently of the test classes by inheriting from `WebApplicationFactory` to create one or more custom factories:</span></span>

1. <span data-ttu-id="b7c11-199">`WebApplicationFactory` [Configurewebhost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost)'ten devralma ve geçersiz kılma.</span><span class="sxs-lookup"><span data-stu-id="b7c11-199">Inherit from `WebApplicationFactory` and override [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost).</span></span> <span data-ttu-id="b7c11-200">[Iwebhostbuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) , hizmet koleksiyonunun [ConfigureServices](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices)ile yapılandırılmasına izin verir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-200">The [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) allows the configuration of the service collection with [ConfigureServices](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices):</span></span>

   [!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/CustomWebApplicationFactory.cs?name=snippet1)]

   <span data-ttu-id="b7c11-201">[Örnek uygulamadaki](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) veritabanı dengeli dağıtımı, yöntemi tarafından gerçekleştirilir `InitializeDbForTests` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-201">Database seeding in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) is performed by the `InitializeDbForTests` method.</span></span> <span data-ttu-id="b7c11-202">Yöntemi, [tümleştirme testleri örneği: test uygulaması kuruluşu](#test-app-organization) bölümünde açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-202">The method is described in the [Integration tests sample: Test app organization](#test-app-organization) section.</span></span>

   <span data-ttu-id="b7c11-203">SUT 'un veritabanı bağlamı `Startup.ConfigureServices` yöntemine kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-203">The SUT's database context is registered in its `Startup.ConfigureServices` method.</span></span> <span data-ttu-id="b7c11-204">Test uygulamasının `builder.ConfigureServices` geri çağırması, uygulamanın kodu yürütüldükten *sonra* yürütülür `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-204">The test app's `builder.ConfigureServices` callback is executed *after* the app's `Startup.ConfigureServices` code is executed.</span></span> <span data-ttu-id="b7c11-205">Yürütme sırası, [genel ana bilgisayar](xref:fundamentals/host/generic-host) için ASP.NET Core 3,0 sürümüne sahip bir son değişiklikten oluşur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-205">The execution order is a breaking change for the [Generic Host](xref:fundamentals/host/generic-host) with the release of ASP.NET Core 3.0.</span></span> <span data-ttu-id="b7c11-206">Uygulamanın veritabanından farklı testler için farklı bir veritabanı kullanmak istiyorsanız, uygulamanın veritabanı bağlamı içinde değiştirilmelidir `builder.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-206">To use a different database for the tests than the app's database, the app's database context must be replaced in `builder.ConfigureServices`.</span></span>

   <span data-ttu-id="b7c11-207">Hala [Web ana bilgisayarını](xref:fundamentals/host/web-host)kullanan sımlar için, test uygulamasının `builder.ConfigureServices` geri çağırması sut kodundan *önce* yürütülür `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-207">For SUTs that still use the [Web Host](xref:fundamentals/host/web-host), the test app's `builder.ConfigureServices` callback is executed *before* the SUT's `Startup.ConfigureServices` code.</span></span> <span data-ttu-id="b7c11-208">Test uygulamasının `builder.ConfigureTestServices` geri çağırması *sonra*yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-208">The test app's `builder.ConfigureTestServices` callback is executed *after*.</span></span>

   <span data-ttu-id="b7c11-209">Örnek uygulama, veritabanı bağlamı için hizmet tanımlayıcısını bulur ve hizmet kaydını kaldırmak için tanımlayıcıyı kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-209">The sample app finds the service descriptor for the database context and uses the descriptor to remove the service registration.</span></span> <span data-ttu-id="b7c11-210">Ardından, fabrika, `ApplicationDbContext` testler için bellek içi veritabanı kullanan yeni bir ekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-210">Next, the factory adds a new `ApplicationDbContext` that uses an in-memory database for the tests.</span></span>

   <span data-ttu-id="b7c11-211">Bellek içi veritabanından farklı bir veritabanına bağlanmak için, `UseInMemoryDatabase` bağlamı farklı bir veritabanına bağlama çağrısını değiştirin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-211">To connect to a different database than the in-memory database, change the `UseInMemoryDatabase` call to connect the context to a different database.</span></span> <span data-ttu-id="b7c11-212">SQL Server test veritabanı kullanmak için:</span><span class="sxs-lookup"><span data-stu-id="b7c11-212">To use a SQL Server test database:</span></span>

   * <span data-ttu-id="b7c11-213">Proje dosyasındaki [Microsoft. EntityFrameworkCore. SqlServer](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/) NuGet paketine başvurun.</span><span class="sxs-lookup"><span data-stu-id="b7c11-213">Reference the [Microsoft.EntityFrameworkCore.SqlServer](https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/) NuGet package in the project file.</span></span>
   * <span data-ttu-id="b7c11-214">`UseSqlServer`Veritabanına bir bağlantı dizesiyle çağrı yapın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-214">Call `UseSqlServer` with a connection string to the database.</span></span>

   ```csharp
   services.AddDbContext<ApplicationDbContext>((options, context) => 
   {
       context.UseSqlServer(
           Configuration.GetConnectionString("TestingDbConnectionString"));
   });
   ```

2. <span data-ttu-id="b7c11-215">Özel `CustomWebApplicationFactory` Test sınıflarında kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-215">Use the custom `CustomWebApplicationFactory` in test classes.</span></span> <span data-ttu-id="b7c11-216">Aşağıdaki örnek, sınıfında fabrikası kullanır `IndexPageTests` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-216">The following example uses the factory in the `IndexPageTests` class:</span></span>

   [!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet1)]

   <span data-ttu-id="b7c11-217">Örnek uygulamanın istemcisi, aşağıdaki yeniden yönlendirmeleri engelleyecek şekilde yapılandırılmıştır `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-217">The sample app's client is configured to prevent the `HttpClient` from following redirects.</span></span> <span data-ttu-id="b7c11-218">Daha sonra, [sahte kimlik doğrulama](#mock-authentication) bölümünde açıklandığı gibi, bu, testlerin uygulamanın ilk yanıtının sonucunu denetlemesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-218">As explained later in the [Mock authentication](#mock-authentication) section, this permits tests to check the result of the app's first response.</span></span> <span data-ttu-id="b7c11-219">İlk yanıt, bu testlerin çoğunda üst bilgiyle bir yeniden yönlendirmelidir `Location` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-219">The first response is a redirect in many of these tests with a `Location` header.</span></span>

3. <span data-ttu-id="b7c11-220">Tipik bir test, `HttpClient` isteği ve yanıtı işlemek için ve yardımcı yöntemlerini kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-220">A typical test uses the `HttpClient` and helper methods to process the request and the response:</span></span>

   [!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="b7c11-221">SUT 'a yönelik herhangi bir POST isteği, uygulamanın [veri koruma antiforgery sistemi](xref:security/data-protection/introduction)tarafından otomatik olarak oluşturulan antiforgery denetimini karşılamalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-221">Any POST request to the SUT must satisfy the antiforgery check that's automatically made by the app's [data protection antiforgery system](xref:security/data-protection/introduction).</span></span> <span data-ttu-id="b7c11-222">Bir testin POST isteğini düzenlemek için test uygulaması şunları kullanmalıdır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-222">In order to arrange for a test's POST request, the test app must:</span></span>

1. <span data-ttu-id="b7c11-223">Sayfa için bir istek oluşturun.</span><span class="sxs-lookup"><span data-stu-id="b7c11-223">Make a request for the page.</span></span>
1. <span data-ttu-id="b7c11-224">Antiforgery tanımlama bilgisini ayrıştırın ve yanıt doğrulama belirtecini istekten isteyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-224">Parse the antiforgery cookie and request validation token from the response.</span></span>
1. <span data-ttu-id="b7c11-225">POST isteğini, antiforgery tanımlama bilgisiyle ve istek doğrulama belirteciyle birlikte yapın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-225">Make the POST request with the antiforgery cookie and request validation token in place.</span></span>

<span data-ttu-id="b7c11-226">`SendAsync`Örnek uygulamadaki yardımcı uzantı yöntemleri (*yardımcılar/Httpclienconversionsions. cs*) ve `GetDocumentAsync` yardımcı yöntemi (*yardımcılar/htmlyardımcıları. cs*), aşağıdaki [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/) yöntemlerle Antiforgery denetimini işlemek için [anglesharp](https://anglesharp.github.io/) ayrıştırıcısını kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-226">The `SendAsync` helper extension methods (*Helpers/HttpClientExtensions.cs*) and the `GetDocumentAsync` helper method (*Helpers/HtmlHelpers.cs*) in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/) use the [AngleSharp](https://anglesharp.github.io/) parser to handle the antiforgery check with the following methods:</span></span>

* <span data-ttu-id="b7c11-227">`GetDocumentAsync`: [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) 'ı alır ve döndürür `IHtmlDocument` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-227">`GetDocumentAsync`: Receives the [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) and returns an `IHtmlDocument`.</span></span> <span data-ttu-id="b7c11-228">`GetDocumentAsync`, orijinalin temelinde bir *sanal yanıt* hazırlayan bir fabrika kullanır `HttpResponseMessage` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-228">`GetDocumentAsync` uses a factory that prepares a *virtual response* based on the original `HttpResponseMessage`.</span></span> <span data-ttu-id="b7c11-229">Daha fazla bilgi için bkz. [Anglesharp belgeleri](https://github.com/AngleSharp/AngleSharp#documentation).</span><span class="sxs-lookup"><span data-stu-id="b7c11-229">For more information, see the [AngleSharp documentation](https://github.com/AngleSharp/AngleSharp#documentation).</span></span>
* <span data-ttu-id="b7c11-230">`SendAsync``HttpClient`bir [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) oluşturun ve istekleri sut 'A göndermek Için [Sendadsync (HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) çağrısı yapın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-230">`SendAsync` extension methods for the `HttpClient` compose an [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) and call [SendAsync(HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) to submit requests to the SUT.</span></span> <span data-ttu-id="b7c11-231">`SendAsync`HTML biçimini kabul etmek için aşırı yüklemeler ( `IHtmlFormElement` ) ve şunları yapın:</span><span class="sxs-lookup"><span data-stu-id="b7c11-231">Overloads for `SendAsync` accept the HTML form (`IHtmlFormElement`) and the following:</span></span>
  * <span data-ttu-id="b7c11-232">Formun () Gönder düğmesi `IHtmlElement`</span><span class="sxs-lookup"><span data-stu-id="b7c11-232">Submit button of the form (`IHtmlElement`)</span></span>
  * <span data-ttu-id="b7c11-233">Form değerleri koleksiyonu ( `IEnumerable<KeyValuePair<string, string>>` )</span><span class="sxs-lookup"><span data-stu-id="b7c11-233">Form values collection (`IEnumerable<KeyValuePair<string, string>>`)</span></span>
  * <span data-ttu-id="b7c11-234">Düğme ( `IHtmlElement` ) ve form değerlerini ( `IEnumerable<KeyValuePair<string, string>>` ) gönder</span><span class="sxs-lookup"><span data-stu-id="b7c11-234">Submit button (`IHtmlElement`) and form values (`IEnumerable<KeyValuePair<string, string>>`)</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-235">[Anglesharp](https://anglesharp.github.io/) , bu konuda ve örnek uygulamada Gösterim amacıyla kullanılan bir üçüncü taraf ayrıştırma kitaplığıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-235">[AngleSharp](https://anglesharp.github.io/) is a third-party parsing library used for demonstration purposes in this topic and the sample app.</span></span> <span data-ttu-id="b7c11-236">ASP.NET Core uygulamalarının tümleştirme testi için AngleSharp desteklenmez veya gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-236">AngleSharp isn't supported or required for integration testing of ASP.NET Core apps.</span></span> <span data-ttu-id="b7c11-237">Diğer çözümleyiciler, [HTML çevikliği paketi (HAP)](https://html-agility-pack.net/)gibi kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-237">Other parsers can be used, such as the [Html Agility Pack (HAP)](https://html-agility-pack.net/).</span></span> <span data-ttu-id="b7c11-238">Diğer bir yaklaşım ise, antiforgery sisteminin istek doğrulama belirtecini ve antiforgery tanımlama bilgisini doğrudan işlemek için kod yazmaktır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-238">Another approach is to write code to handle the antiforgery system's request verification token and antiforgery cookie directly.</span></span>

## <a name="customize-the-client-with-withwebhostbuilder"></a><span data-ttu-id="b7c11-239">WithWebHostBuilder ile istemciyi özelleştirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-239">Customize the client with WithWebHostBuilder</span></span>

<span data-ttu-id="b7c11-240">Bir test yönteminde ek yapılandırma gerektiğinde, [Withwebhostbuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) , `WebApplicationFactory` yapılandırmaya göre daha fazla özelleştirilmiş bir [ıwebhostbuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) ile yeni bir oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-240">When additional configuration is required within a test method, [WithWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) creates a new `WebApplicationFactory` with an [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) that is further customized by configuration.</span></span>

<span data-ttu-id="b7c11-241">`Post_DeleteMessageHandler_ReturnsRedirectToRoot` [Örnek uygulamanın](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) test yöntemi öğesinin kullanımını gösterir `WithWebHostBuilder` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-241">The `Post_DeleteMessageHandler_ReturnsRedirectToRoot` test method of the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) demonstrates the use of `WithWebHostBuilder`.</span></span> <span data-ttu-id="b7c11-242">Bu test, SUT 'da form gönderimini tetikleyerek veritabanında silme işlemini gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-242">This test performs a record delete in the database by triggering a form submission in the SUT.</span></span>

<span data-ttu-id="b7c11-243">Sınıftaki başka bir test `IndexPageTests` veritabanındaki tüm kayıtları silen ve yönteminden önce çalışabilen bir işlem gerçekleştirdiğinden `Post_DeleteMessageHandler_ReturnsRedirectToRoot` , sut 'in silinmesine yönelik bir kaydın mevcut olduğundan emin olmak için veritabanı bu test yönteminde yeniden uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-243">Because another test in the `IndexPageTests` class performs an operation that deletes all of the records in the database and may run before the `Post_DeleteMessageHandler_ReturnsRedirectToRoot` method, the database is reseeded in this test method to ensure that a record is present for the SUT to delete.</span></span> <span data-ttu-id="b7c11-244">SUT içindeki formun ilk Sil düğmesini seçmek, `messages` sut isteğine göre benzetilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-244">Selecting the first delete button of the `messages` form in the SUT is simulated in the request to the SUT:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet3)]

## <a name="client-options"></a><span data-ttu-id="b7c11-245">İstemci seçenekleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-245">Client options</span></span>

<span data-ttu-id="b7c11-246">Aşağıdaki tabloda, örnek oluştururken kullanılabilen varsayılan [Webapplicationfactoryclientoptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) gösterilmektedir `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-246">The following table shows the default [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) available when creating `HttpClient` instances.</span></span>

| <span data-ttu-id="b7c11-247">Seçenek</span><span class="sxs-lookup"><span data-stu-id="b7c11-247">Option</span></span> | <span data-ttu-id="b7c11-248">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-248">Description</span></span> | <span data-ttu-id="b7c11-249">Varsayılan</span><span class="sxs-lookup"><span data-stu-id="b7c11-249">Default</span></span> |
| ------ | ----------- | ------- |
| [<span data-ttu-id="b7c11-250">Allowoto yeniden yönlendirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-250">AllowAutoRedirect</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) | <span data-ttu-id="b7c11-251">`HttpClient`Örneklerin otomatik olarak yeniden yönlendirme yanıtlarını izleyip izmeyeceğini alır veya ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-251">Gets or sets whether or not `HttpClient` instances should automatically follow redirect responses.</span></span> | `true` |
| [<span data-ttu-id="b7c11-252">BaseAddress</span><span class="sxs-lookup"><span data-stu-id="b7c11-252">BaseAddress</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.baseaddress) | <span data-ttu-id="b7c11-253">Örneklerin temel adresini alır veya ayarlar `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-253">Gets or sets the base address of `HttpClient` instances.</span></span> | `http://localhost` |
| [<span data-ttu-id="b7c11-254">HandleCookies</span><span class="sxs-lookup"><span data-stu-id="b7c11-254">HandleCookies</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.handlecookies) | <span data-ttu-id="b7c11-255">`HttpClient`Örneklerin tanımlama bilgilerini işlemesinin gerekip gerekmediğini alır veya ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-255">Gets or sets whether `HttpClient` instances should handle cookies.</span></span> | `true` |
| [<span data-ttu-id="b7c11-256">Maxautomaticyönlendirmeler</span><span class="sxs-lookup"><span data-stu-id="b7c11-256">MaxAutomaticRedirections</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.maxautomaticredirections) | <span data-ttu-id="b7c11-257">Örneklerin izlemesi gereken en fazla yeniden yönlendirme yanıtı sayısını alır veya ayarlar `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-257">Gets or sets the maximum number of redirect responses that `HttpClient` instances should follow.</span></span> | <span data-ttu-id="b7c11-258">7</span><span class="sxs-lookup"><span data-stu-id="b7c11-258">7</span></span> |

<span data-ttu-id="b7c11-259">Sınıfını oluşturun `WebApplicationFactoryClientOptions` ve [createclient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) yöntemine geçirin (varsayılan değerler kod örneğinde gösterilir):</span><span class="sxs-lookup"><span data-stu-id="b7c11-259">Create the `WebApplicationFactoryClientOptions` class and pass it to the [CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) method (default values are shown in the code example):</span></span>

```csharp
// Default client option values are shown
var clientOptions = new WebApplicationFactoryClientOptions();
clientOptions.AllowAutoRedirect = true;
clientOptions.BaseAddress = new Uri("http://localhost");
clientOptions.HandleCookies = true;
clientOptions.MaxAutomaticRedirections = 7;

_client = _factory.CreateClient(clientOptions);
```

## <a name="inject-mock-services"></a><span data-ttu-id="b7c11-260">Sahte hizmetler ekleme</span><span class="sxs-lookup"><span data-stu-id="b7c11-260">Inject mock services</span></span>

<span data-ttu-id="b7c11-261">Hizmetler, ana bilgisayar tasarımcısında [Configuretestservices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) çağrısıyla bir testte geçersiz kılınabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-261">Services can be overridden in a test with a call to [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) on the host builder.</span></span> <span data-ttu-id="b7c11-262">**Sahte hizmetleri eklemek için SUT, `Startup` yöntemi olan bir sınıfa sahip olmalıdır `Startup.ConfigureServices` .**</span><span class="sxs-lookup"><span data-stu-id="b7c11-262">**To inject mock services, the SUT must have a `Startup` class with a `Startup.ConfigureServices` method.**</span></span>

<span data-ttu-id="b7c11-263">Örnek SUT, bir teklif döndüren kapsamlı bir hizmet içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-263">The sample SUT includes a scoped service that returns a quote.</span></span> <span data-ttu-id="b7c11-264">Dizin sayfası istendiğinde, teklif Dizin sayfasındaki gizli bir alana katıştırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-264">The quote is embedded in a hidden field on the Index page when the Index page is requested.</span></span>

<span data-ttu-id="b7c11-265">*Hizmetler/ıquoteservice. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-265">*Services/IQuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Services/IQuoteService.cs?name=snippet1)]

<span data-ttu-id="b7c11-266">*Hizmetler/QuoteService. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-266">*Services/QuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Services/QuoteService.cs?name=snippet1)]

<span data-ttu-id="b7c11-267">*Startup.cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-267">*Startup.cs*:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet2)]

<span data-ttu-id="b7c11-268">*Pages/Index. cshtml. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-268">*Pages/Index.cshtml.cs*:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml.cs?name=snippet1&highlight=4,9,20,26)]

<span data-ttu-id="b7c11-269">*Sayfa/dizin. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-269">*Pages/Index.cs*:</span></span>

[!code-cshtml[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml?name=snippet_Quote)]

<span data-ttu-id="b7c11-270">Aşağıdaki biçimlendirme, SUT uygulaması çalıştırıldığında oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-270">The following markup is generated when the SUT app is run:</span></span>

```html
<input id="quote" type="hidden" value="Come on, Sarah. We&#x27;ve an appointment in 
    London, and we&#x27;re already 30,000 years late.">
```

<span data-ttu-id="b7c11-271">Bir tümleştirme testinde hizmet ve teklif ekleme işlemini test etmek için, test tarafından SUT 'ye bir sahte hizmet eklenir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-271">To test the service and quote injection in an integration test, a mock service is injected into the SUT by the test.</span></span> <span data-ttu-id="b7c11-272">Sahte hizmet, uygulamanın `QuoteService` adı verilen test uygulaması tarafından verilen bir hizmetle değiştirilir `TestQuoteService` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-272">The mock service replaces the app's `QuoteService` with a service provided by the test app, called `TestQuoteService`:</span></span>

<span data-ttu-id="b7c11-273">*IntegrationTests.IndexPageTests.cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-273">*IntegrationTests.IndexPageTests.cs*:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet4)]

<span data-ttu-id="b7c11-274">`ConfigureTestServices`çağrılır ve kapsamlı hizmet kaydedilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-274">`ConfigureTestServices` is called, and the scoped service is registered:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet5&highlight=7-10,17,20-21)]

<span data-ttu-id="b7c11-275">Testin yürütülmesi sırasında üretilen biçimlendirme tarafından sağlanan teklif metnini yansıtır `TestQuoteService` , bu nedenle onaylama işlemi geçer:</span><span class="sxs-lookup"><span data-stu-id="b7c11-275">The markup produced during the test's execution reflects the quote text supplied by `TestQuoteService`, thus the assertion passes:</span></span>

```html
<input id="quote" type="hidden" value="Something&#x27;s interfering with time, 
    Mr. Scarman, and time is my business.">
```

## <a name="mock-authentication"></a><span data-ttu-id="b7c11-276">Sahte kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="b7c11-276">Mock authentication</span></span>

<span data-ttu-id="b7c11-277">`AuthTests`Sınıftaki testler güvenli bir uç noktanın bulunup bulunmadığını denetler:</span><span class="sxs-lookup"><span data-stu-id="b7c11-277">Tests in the `AuthTests` class check that a secure endpoint:</span></span>

* <span data-ttu-id="b7c11-278">Kimliği doğrulanmamış bir kullanıcıyı uygulamanın oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-278">Redirects an unauthenticated user to the app's Login page.</span></span>
* <span data-ttu-id="b7c11-279">Kimliği doğrulanmış bir kullanıcı için içerik döndürür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-279">Returns content for an authenticated user.</span></span>

<span data-ttu-id="b7c11-280">SUT sayfasında, sayfada bir `/SecurePage` [Authorizefilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) uygulamak için Bu sayfa bir [authorizepage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) kuralı kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-280">In the SUT, the `/SecurePage` page uses an [AuthorizePage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) convention to apply an [AuthorizeFilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) to the page.</span></span> <span data-ttu-id="b7c11-281">Daha fazla bilgi için bkz. [ Razor Sayfalar yetkilendirme kuralları](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span><span class="sxs-lookup"><span data-stu-id="b7c11-281">For more information, see [Razor Pages authorization conventions](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet1)]

<span data-ttu-id="b7c11-282">`Get_SecurePageRedirectsAnUnauthenticatedUser`Testte, bir [Webapplicationfactoryclientoptions, Allowclıredirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) ' i ayarlayarak [yeniden](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) yönlendirmeye izin vermez olarak ayarlanır `false` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-282">In the `Get_SecurePageRedirectsAnUnauthenticatedUser` test, a [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) is set to disallow redirects by setting [AllowAutoRedirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) to `false`:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet2)]

<span data-ttu-id="b7c11-283">İstemcinin yeniden yönlendirmeyi izlemeye izin vererek aşağıdaki denetimler yapılabilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-283">By disallowing the client to follow the redirect, the following checks can be made:</span></span>

* <span data-ttu-id="b7c11-284">SUT tarafından döndürülen durum kodu, oturum açma sayfasına yeniden yönlendirmeden sonra, [HttpStatusCode. Tamam](/dotnet/api/system.net.httpstatuscode)olacak şekilde, son durum koduna değil beklenen [HttpStatusCode. Redirect](/dotnet/api/system.net.httpstatuscode) sonucuyla denetlenebilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-284">The status code returned by the SUT can be checked against the expected [HttpStatusCode.Redirect](/dotnet/api/system.net.httpstatuscode) result, not the final status code after the redirect to the Login page, which would be [HttpStatusCode.OK](/dotnet/api/system.net.httpstatuscode).</span></span>
* <span data-ttu-id="b7c11-285">`Location`Yanıt üst bilgilerindeki üst bilgi değeri, `http://localhost/Identity/Account/Login` üst bilgi bulunmayan son oturum açma sayfası yanıtı değil, ile başladığı onaylanacak şekilde denetlenir `Location` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-285">The `Location` header value in the response headers is checked to confirm that it starts with `http://localhost/Identity/Account/Login`, not the final Login page response, where the `Location` header wouldn't be present.</span></span>

<span data-ttu-id="b7c11-286">Test uygulaması, <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> kimlik doğrulama ve yetkilendirme işlemlerini test etmek için bir [Configuretestservices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) içinde bir model oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-286">The test app can mock an <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> in [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) in order to test aspects of authentication and authorization.</span></span> <span data-ttu-id="b7c11-287">En az bir senaryo, bir [kimlik doğrulayan Poesult. Success](xref:Microsoft.AspNetCore.Authentication.AuthenticateResult.Success*)döndürür:</span><span class="sxs-lookup"><span data-stu-id="b7c11-287">A minimal scenario returns an [AuthenticateResult.Success](xref:Microsoft.AspNetCore.Authentication.AuthenticateResult.Success*):</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet4&highlight=11-18)]

<span data-ttu-id="b7c11-288">, `TestAuthHandler` Kimlik doğrulama düzeni `Test` için kaydedildiği yere ayarlandığında kullanıcının kimliğini doğrulamak için çağrılır `AddAuthentication` `ConfigureTestServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-288">The `TestAuthHandler` is called to authenticate a user when the authentication scheme is set to `Test` where `AddAuthentication` is registered for `ConfigureTestServices`.</span></span> <span data-ttu-id="b7c11-289">`Test`Düzenin, uygulamanızın beklediği şemayla eşleşmesi önemlidir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-289">It's important for the `Test` scheme to match the scheme your app expects.</span></span> <span data-ttu-id="b7c11-290">Aksi takdirde kimlik doğrulaması çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="b7c11-290">Otherwise, authentication won't work.</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet3&highlight=7-12)]

<span data-ttu-id="b7c11-291">Hakkında daha fazla bilgi için `WebApplicationFactoryClientOptions` [istemci seçenekleri](#client-options) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-291">For more information on `WebApplicationFactoryClientOptions`, see the [Client options](#client-options) section.</span></span>

## <a name="set-the-environment"></a><span data-ttu-id="b7c11-292">Ortamı ayarlama</span><span class="sxs-lookup"><span data-stu-id="b7c11-292">Set the environment</span></span>

<span data-ttu-id="b7c11-293">Varsayılan olarak, SUT 'nin ana bilgisayar ve uygulama ortamı geliştirme ortamını kullanacak şekilde yapılandırılmıştır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-293">By default, the SUT's host and app environment is configured to use the Development environment.</span></span> <span data-ttu-id="b7c11-294">Kullanırken SUT ortamını geçersiz kılmak için `IHostBuilder` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-294">To override the SUT's environment when using `IHostBuilder`:</span></span>

* <span data-ttu-id="b7c11-295">`ASPNETCORE_ENVIRONMENT`Ortam değişkenini (örneğin,,, `Staging` veya gibi `Production` başka bir özel değeri `Testing` ) ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-295">Set the `ASPNETCORE_ENVIRONMENT` environment variable (for example, `Staging`, `Production`, or other custom value, such as `Testing`).</span></span>
* <span data-ttu-id="b7c11-296">`CreateHostBuilder`Ön eki olan ortam değişkenlerini okumak için test uygulamasında geçersiz kılın `ASPNETCORE` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-296">Override `CreateHostBuilder` in the test app to read environment variables prefixed with `ASPNETCORE`.</span></span>

```csharp
protected override IHostBuilder CreateHostBuilder() =>
    base.CreateHostBuilder()
        .ConfigureHostConfiguration(
            config => config.AddEnvironmentVariables("ASPNETCORE"));
```

<span data-ttu-id="b7c11-297">SUT Web konağını ( `IWebHostBuilder` ) kullanıyorsa, geçersiz kıl `CreateWebHostBuilder` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-297">If the SUT uses the Web Host (`IWebHostBuilder`), override `CreateWebHostBuilder`:</span></span>

```csharp
protected override IWebHostBuilder CreateWebHostBuilder() =>
    base.CreateWebHostBuilder().UseEnvironment("Testing");
```

## <a name="how-the-test-infrastructure-infers-the-app-content-root-path"></a><span data-ttu-id="b7c11-298">Test altyapısının uygulama içeriği kök yolunu nasıl öğrendiğini</span><span class="sxs-lookup"><span data-stu-id="b7c11-298">How the test infrastructure infers the app content root path</span></span>

<span data-ttu-id="b7c11-299">`WebApplicationFactory`Oluşturucu, derleme üzerinde bir anahtarla eşit anahtar olan tümleştirme testlerini içeren bir [Webapplicationfactorycontentrootattribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) arayarak uygulama [içeriği kök](xref:fundamentals/index#content-root) yolunu alır `TEntryPoint` `System.Reflection.Assembly.FullName` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-299">The `WebApplicationFactory` constructor infers the app [content root](xref:fundamentals/index#content-root) path by searching for a [WebApplicationFactoryContentRootAttribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) on the assembly containing the integration tests with a key equal to the `TEntryPoint` assembly `System.Reflection.Assembly.FullName`.</span></span> <span data-ttu-id="b7c11-300">Doğru anahtara sahip bir özniteliğin bulunamaması durumunda, `WebApplicationFactory` bir çözüm dosyası (*. sln*) aramaya geri döner ve `TEntryPoint` derleme adını çözüm dizinine ekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-300">In case an attribute with the correct key isn't found, `WebApplicationFactory` falls back to searching for a solution file (*.sln*) and appends the `TEntryPoint` assembly name to the solution directory.</span></span> <span data-ttu-id="b7c11-301">Uygulama kök dizini (içerik kök yolu) görünümleri ve içerik dosyalarını saptamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-301">The app root directory (the content root path) is used to discover views and content files.</span></span>

## <a name="disable-shadow-copying"></a><span data-ttu-id="b7c11-302">Gölge kopyalamayı devre dışı bırak</span><span class="sxs-lookup"><span data-stu-id="b7c11-302">Disable shadow copying</span></span>

<span data-ttu-id="b7c11-303">Gölge kopyalama, testlerin çıkış dizininden farklı bir dizinde yürütülmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-303">Shadow copying causes the tests to execute in a different directory than the output directory.</span></span> <span data-ttu-id="b7c11-304">Testlerin düzgün çalışması için gölge kopyalama devre dışı bırakılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-304">For tests to work properly, shadow copying must be disabled.</span></span> <span data-ttu-id="b7c11-305">[Örnek uygulama](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) xUnit kullanır ve doğru yapılandırma ayarıyla bir *xunit.runner.js* dosyaya ekleyerek xUnit için gölge kopyalamayı devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-305">The [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) uses xUnit and disables shadow copying for xUnit by including an *xunit.runner.json* file with the correct configuration setting.</span></span> <span data-ttu-id="b7c11-306">Daha fazla bilgi için bkz. [JSON Ile xUnit yapılandırma](https://xunit.github.io/docs/configuring-with-json.html).</span><span class="sxs-lookup"><span data-stu-id="b7c11-306">For more information, see [Configuring xUnit with JSON](https://xunit.github.io/docs/configuring-with-json.html).</span></span>

<span data-ttu-id="b7c11-307">Aşağıdaki içeriğe sahip test projesinin köküne dosya *xunit.runner.js* ekleyin:</span><span class="sxs-lookup"><span data-stu-id="b7c11-307">Add the *xunit.runner.json* file to root of the test project with the following content:</span></span>

```json
{
  "shadowCopy": false
}
```

## <a name="disposal-of-objects"></a><span data-ttu-id="b7c11-308">Nesnelerin elden çıkarılması</span><span class="sxs-lookup"><span data-stu-id="b7c11-308">Disposal of objects</span></span>

<span data-ttu-id="b7c11-309">`IClassFixture`Uygulamanın testleri yürütüldükten sonra, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) ve [HttpClient](/dotnet/api/system.net.http.httpclient) , [webapplicationfactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1)'nin xUnit 'i çıkardığı zaman yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-309">After the tests of the `IClassFixture` implementation are executed, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) and [HttpClient](/dotnet/api/system.net.http.httpclient) are disposed when xUnit disposes of the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1).</span></span> <span data-ttu-id="b7c11-310">Geliştirici tarafından oluşturulan nesneler elden çıkarma gerektiriyorsa, bunları `IClassFixture` uygulamada atın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-310">If objects instantiated by the developer require disposal, dispose of them in the `IClassFixture` implementation.</span></span> <span data-ttu-id="b7c11-311">Daha fazla bilgi için bkz. [Dispose yöntemi uygulama](/dotnet/standard/garbage-collection/implementing-dispose).</span><span class="sxs-lookup"><span data-stu-id="b7c11-311">For more information, see [Implementing a Dispose method](/dotnet/standard/garbage-collection/implementing-dispose).</span></span>

## <a name="integration-tests-sample"></a><span data-ttu-id="b7c11-312">Tümleştirme Testleri örneği</span><span class="sxs-lookup"><span data-stu-id="b7c11-312">Integration tests sample</span></span>

<span data-ttu-id="b7c11-313">[Örnek uygulama](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) iki uygulamalardan oluşur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-313">The [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) is composed of two apps:</span></span>

| <span data-ttu-id="b7c11-314">Uygulama</span><span class="sxs-lookup"><span data-stu-id="b7c11-314">App</span></span> | <span data-ttu-id="b7c11-315">Proje dizini</span><span class="sxs-lookup"><span data-stu-id="b7c11-315">Project directory</span></span> | <span data-ttu-id="b7c11-316">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-316">Description</span></span> |
| --- | ----------------- | ----------- |
| <span data-ttu-id="b7c11-317">İleti uygulaması (SUT)</span><span class="sxs-lookup"><span data-stu-id="b7c11-317">Message app (the SUT)</span></span> | <span data-ttu-id="b7c11-318">*src/ Razor pagesproject*</span><span class="sxs-lookup"><span data-stu-id="b7c11-318">*src/RazorPagesProject*</span></span> | <span data-ttu-id="b7c11-319">Bir kullanıcının, iletileri eklemesini, silmesini, silmesini ve analiz etmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-319">Allows a user to add, delete one, delete all, and analyze messages.</span></span> |
| <span data-ttu-id="b7c11-320">Test uygulaması</span><span class="sxs-lookup"><span data-stu-id="b7c11-320">Test app</span></span> | <span data-ttu-id="b7c11-321">*testler/ Razor pagesproject. Tests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-321">*tests/RazorPagesProject.Tests*</span></span> | <span data-ttu-id="b7c11-322">SUT test tümleştirmesi için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-322">Used to integration test the SUT.</span></span> |

<span data-ttu-id="b7c11-323">Testler, [Visual Studio](https://visualstudio.microsoft.com)gıbı bir IDE 'nin yerleşik test özellikleri kullanılarak çalıştırılabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-323">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](https://visualstudio.microsoft.com).</span></span> <span data-ttu-id="b7c11-324">[Visual Studio Code](https://code.visualstudio.com/) veya komut satırı kullanıyorsanız, *testler/ Razor pagesproject. Tests* dizinindeki bir komut isteminde aşağıdaki komutu yürütün:</span><span class="sxs-lookup"><span data-stu-id="b7c11-324">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesProject.Tests* directory:</span></span>

```console
dotnet test
```

### <a name="message-app-sut-organization"></a><span data-ttu-id="b7c11-325">İleti uygulaması (SUT) kuruluşu</span><span class="sxs-lookup"><span data-stu-id="b7c11-325">Message app (SUT) organization</span></span>

<span data-ttu-id="b7c11-326">SUT, Razor aşağıdaki özelliklere sahip bir sayfalar ileti sistemidir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-326">The SUT is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="b7c11-327">Uygulamanın (*Pages/Index. cshtml* ve *Pages/index. cshtml. cs*) dizin sayfası, iletilerin eklenmesi, silinmesini ve ANALIZINI denetlemek için bir UI ve sayfa modeli yöntemleri sağlar (ileti başına ortalama sözcük).</span><span class="sxs-lookup"><span data-stu-id="b7c11-327">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (average words per message).</span></span>
* <span data-ttu-id="b7c11-328">Bir ileti, `Message` sınıfı (*Data/Message. cs*) ile iki özelliği olan ( `Id` anahtar) ve `Text` (ileti) açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-328">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="b7c11-329">`Text`Özelliği gereklidir ve 200 karakterle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-329">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="b7c11-330">İletiler, [Entity Framework bellek içi veritabanı](/ef/core/providers/in-memory/)&#8224; kullanılarak depolanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-330">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="b7c11-331">Uygulama, veritabanı bağlamı sınıfında ( `AppDbContext` *Data/AppDbContext. cs*) bir veri ERIŞIM katmanı (dal) içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-331">The app contains a data access layer (DAL) in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span>
* <span data-ttu-id="b7c11-332">Veritabanı uygulama başlangıcında boşsa, ileti deposu üç iletiyle başlatılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-332">If the database is empty on app startup, the message store is initialized with three messages.</span></span>
* <span data-ttu-id="b7c11-333">Uygulama `/SecurePage` yalnızca kimliği doğrulanmış bir kullanıcı tarafından erişilebilen bir içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-333">The app includes a `/SecurePage` that can only be accessed by an authenticated user.</span></span>

<span data-ttu-id="b7c11-334">EF konusunda, [InMemory Ile Test](/ef/core/miscellaneous/testing/in-memory)&#8224;, MSTest ile testler için bellek içi bir veritabanının nasıl kullanılacağını açıklar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-334">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="b7c11-335">Bu konu [xUnit](https://xunit.github.io/) test çerçevesini kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-335">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="b7c11-336">Farklı test çerçeveleri genelinde test kavramları ve test uygulamaları benzerdir ancak aynı değildir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-336">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="b7c11-337">Uygulama, depo desenini kullanmıyor ve [Iş birimi (UoW) düzeninin](https://martinfowler.com/eaaCatalog/unitOfWork.html)etkin bir örneği olmamasına karşın, Razor Sayfalar bu geliştirme düzenlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-337">Although the app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="b7c11-338">Daha fazla bilgi için bkz. [altyapı Kalıcılık katmanını tasarlama](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) ve [Test denetleyicisi mantığı](/aspnet/core/mvc/controllers/testing) (örnek, depo modelini uygular).</span><span class="sxs-lookup"><span data-stu-id="b7c11-338">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and [Test controller logic](/aspnet/core/mvc/controllers/testing) (the sample implements the repository pattern).</span></span>

### <a name="test-app-organization"></a><span data-ttu-id="b7c11-339">Test uygulaması kuruluşu</span><span class="sxs-lookup"><span data-stu-id="b7c11-339">Test app organization</span></span>

<span data-ttu-id="b7c11-340">Test uygulaması, *testler/ Razor pagesproject. Tests* dizini içindeki bir konsol uygulamasıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-340">The test app is a console app inside the *tests/RazorPagesProject.Tests* directory.</span></span>

| <span data-ttu-id="b7c11-341">Uygulama dizinini test et</span><span class="sxs-lookup"><span data-stu-id="b7c11-341">Test app directory</span></span> | <span data-ttu-id="b7c11-342">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-342">Description</span></span> |
| ------------------ | ----------- |
| <span data-ttu-id="b7c11-343">*AuthTests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-343">*AuthTests*</span></span> | <span data-ttu-id="b7c11-344">İçin test yöntemleri içerir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-344">Contains test methods for:</span></span><ul><li><span data-ttu-id="b7c11-345">Güvenli bir sayfaya, kimliği doğrulanmamış bir kullanıcıyla erişme.</span><span class="sxs-lookup"><span data-stu-id="b7c11-345">Accessing a secure page by an unauthenticated user.</span></span></li><li><span data-ttu-id="b7c11-346">Bir sahte ile kimliği doğrulanmış bir kullanıcı tarafından güvenli bir sayfaya erişme <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> .</span><span class="sxs-lookup"><span data-stu-id="b7c11-346">Accessing a secure page by an authenticated user with a mock <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1>.</span></span></li><li><span data-ttu-id="b7c11-347">GitHub kullanıcı profilini alma ve profilin Kullanıcı oturum açma bilgilerini denetleme.</span><span class="sxs-lookup"><span data-stu-id="b7c11-347">Obtaining a GitHub user profile and checking the profile's user login.</span></span></li></ul> |
| <span data-ttu-id="b7c11-348">*BasicTests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-348">*BasicTests*</span></span> | <span data-ttu-id="b7c11-349">Yönlendirme ve içerik türü için bir test yöntemi içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-349">Contains a test method for routing and content type.</span></span> |
| <span data-ttu-id="b7c11-350">*Tümleştirme Testleri*</span><span class="sxs-lookup"><span data-stu-id="b7c11-350">*IntegrationTests*</span></span> | <span data-ttu-id="b7c11-351">Özel sınıf kullanan dizin sayfası için tümleştirme testlerini içerir `WebApplicationFactory` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-351">Contains the integration tests for the Index page using custom `WebApplicationFactory` class.</span></span> |
| <span data-ttu-id="b7c11-352">*Yardımcılar/yardımcı programlar*</span><span class="sxs-lookup"><span data-stu-id="b7c11-352">*Helpers/Utilities*</span></span> | <ul><li><span data-ttu-id="b7c11-353">*Utilities.cs* , `InitializeDbForTests` veritabanını test verileriyle tohum için kullanılan yöntemi içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-353">*Utilities.cs* contains the `InitializeDbForTests` method used to seed the database with test data.</span></span></li><li><span data-ttu-id="b7c11-354">*HtmlHelpers.cs* `IHtmlDocument` , test yöntemleri tarafından kullanılmak üzere anglesharp döndüren bir yöntem sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-354">*HtmlHelpers.cs* provides a method to return an AngleSharp `IHtmlDocument` for use by the test methods.</span></span></li><li><span data-ttu-id="b7c11-355">*HttpClientExtensions.cs* `SendAsync` , istekleri sut 'a göndermek için için aşırı yüklemeler sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-355">*HttpClientExtensions.cs* provide overloads for `SendAsync` to submit requests to the SUT.</span></span></li></ul> |

<span data-ttu-id="b7c11-356">Test çerçevesi [xUnit](https://xunit.github.io/)' dir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-356">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="b7c11-357">Tümleştirme testleri, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)içeren [Microsoft. Aspnetcore. testhost](/dotnet/api/microsoft.aspnetcore.testhost)kullanılarak yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-357">Integration tests are conducted using the [Microsoft.AspNetCore.TestHost](/dotnet/api/microsoft.aspnetcore.testhost), which includes the [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver).</span></span> <span data-ttu-id="b7c11-358">Test ana bilgisayarı ve test sunucusunu yapılandırmak için [Microsoft. AspNetCore. Mvc. Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paketi kullanıldığından, ve paketleri test uygulamasındaki `TestHost` `TestServer` Proje dosyasında veya geliştirici yapılandırmasında doğrudan paket başvuruları gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="b7c11-358">Because the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package is used to configure the test host and test server, the `TestHost` and `TestServer` packages don't require direct package references in the test app's project file or developer configuration in the test app.</span></span>

<span data-ttu-id="b7c11-359">**Test için veritabanının temelini sağlama**</span><span class="sxs-lookup"><span data-stu-id="b7c11-359">**Seeding the database for testing**</span></span>

<span data-ttu-id="b7c11-360">Tümleştirme testleri genellikle veritabanında test yürütmeden önce küçük bir veri kümesi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-360">Integration tests usually require a small dataset in the database prior to the test execution.</span></span> <span data-ttu-id="b7c11-361">Örneğin, veritabanı kaydı silme için bir silme testi çağrılarında, silme isteğinin başarılı olması için veritabanının en az bir kaydı olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-361">For example, a delete test calls for a database record deletion, so the database must have at least one record for the delete request to succeed.</span></span>

<span data-ttu-id="b7c11-362">Örnek uygulama, *Utilities.cs* içinde testlerin, yürütme sırasında kullanabileceği üç iletiyle birlikte veritabanını kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-362">The sample app seeds the database with three messages in *Utilities.cs* that tests can use when they execute:</span></span>

[!code-csharp[](integration-tests/samples/3.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/Helpers/Utilities.cs?name=snippet1)]

<span data-ttu-id="b7c11-363">SUT 'un veritabanı bağlamı `Startup.ConfigureServices` yöntemine kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-363">The SUT's database context is registered in its `Startup.ConfigureServices` method.</span></span> <span data-ttu-id="b7c11-364">Test uygulamasının `builder.ConfigureServices` geri çağırması, uygulamanın kodu yürütüldükten *sonra* yürütülür `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-364">The test app's `builder.ConfigureServices` callback is executed *after* the app's `Startup.ConfigureServices` code is executed.</span></span> <span data-ttu-id="b7c11-365">Testler için farklı bir veritabanı kullanmak istiyorsanız, uygulamanın veritabanı bağlamı içinde değiştirilmelidir `builder.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-365">To use a different database for the tests, the app's database context must be replaced in `builder.ConfigureServices`.</span></span> <span data-ttu-id="b7c11-366">Daha fazla bilgi için, [WebApplicationFactory 'Yi özelleştirme](#customize-webapplicationfactory) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-366">For more information, see the [Customize WebApplicationFactory](#customize-webapplicationfactory) section.</span></span>

<span data-ttu-id="b7c11-367">Hala [Web ana bilgisayarını](xref:fundamentals/host/web-host)kullanan sımlar için, test uygulamasının `builder.ConfigureServices` geri çağırması sut kodundan *önce* yürütülür `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-367">For SUTs that still use the [Web Host](xref:fundamentals/host/web-host), the test app's `builder.ConfigureServices` callback is executed *before* the SUT's `Startup.ConfigureServices` code.</span></span> <span data-ttu-id="b7c11-368">Test uygulamasının `builder.ConfigureTestServices` geri çağırması *sonra*yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-368">The test app's `builder.ConfigureTestServices` callback is executed *after*.</span></span>

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="b7c11-369">Tümleştirme sınamaları, uygulamanın bileşenlerinin veritabanı, dosya sistemi ve ağ gibi destekleyici altyapısını içeren bir düzeyde doğru şekilde çalışmasını güvence altına alır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-369">Integration tests ensure that an app's components function correctly at a level that includes the app's supporting infrastructure, such as the database, file system, and network.</span></span> <span data-ttu-id="b7c11-370">ASP.NET Core, test Web ana bilgisayarı ve bellek içi test sunucusu olan bir birim testi çerçevesini kullanarak tümleştirme testlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-370">ASP.NET Core supports integration tests using a unit test framework with a test web host and an in-memory test server.</span></span>

<span data-ttu-id="b7c11-371">Bu konuda, birim testlerinin temel bir şekilde anlaşıldığı varsayılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-371">This topic assumes a basic understanding of unit tests.</span></span> <span data-ttu-id="b7c11-372">Test kavramları hakkında bilgi sahibi değilseniz, [.NET Core 'Da birim testine ve .NET Standard](/dotnet/core/testing/) konusuna ve bağlı içeriğine bakın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-372">If unfamiliar with test concepts, see the [Unit Testing in .NET Core and .NET Standard](/dotnet/core/testing/) topic and its linked content.</span></span>

<span data-ttu-id="b7c11-373">[Örnek kodu görüntüleme veya indirme](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) ([nasıl indirileceği](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b7c11-373">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="b7c11-374">Örnek uygulama bir Razor Sayfalar uygulamasıdır ve sayfaların temel olarak anlaşıldığını varsayar Razor .</span><span class="sxs-lookup"><span data-stu-id="b7c11-374">The sample app is a Razor Pages app and assumes a basic understanding of Razor Pages.</span></span> <span data-ttu-id="b7c11-375">Sayfalarla alışkın değilseniz Razor , aşağıdaki konulara bakın:</span><span class="sxs-lookup"><span data-stu-id="b7c11-375">If unfamiliar with Razor Pages, see the following topics:</span></span>

* <span data-ttu-id="b7c11-376">[Sayfalara giriş Razor](xref:razor-pages/index)</span><span class="sxs-lookup"><span data-stu-id="b7c11-376">[Introduction to Razor Pages](xref:razor-pages/index)</span></span>
* <span data-ttu-id="b7c11-377">[Sayfalarla çalışmaya başlama Razor](xref:tutorials/razor-pages/razor-pages-start)</span><span class="sxs-lookup"><span data-stu-id="b7c11-377">[Get started with Razor Pages](xref:tutorials/razor-pages/razor-pages-start)</span></span>
* <span data-ttu-id="b7c11-378">[RazorSayfalar birim testleri](xref:test/razor-pages-tests)</span><span class="sxs-lookup"><span data-stu-id="b7c11-378">[Razor Pages unit tests](xref:test/razor-pages-tests)</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-379">Maça 'Ları test etmek için, bir tarayıcıyı otomatikleştirebilen [Selenium](https://www.seleniumhq.org/)gibi bir araç öneririz.</span><span class="sxs-lookup"><span data-stu-id="b7c11-379">For testing SPAs, we recommended a tool such as [Selenium](https://www.seleniumhq.org/), which can automate a browser.</span></span>

## <a name="introduction-to-integration-tests"></a><span data-ttu-id="b7c11-380">Tümleştirme testlerine giriş</span><span class="sxs-lookup"><span data-stu-id="b7c11-380">Introduction to integration tests</span></span>

<span data-ttu-id="b7c11-381">Tümleştirme testleri, bir uygulamanın bileşenlerini [birim testlerinden](/dotnet/core/testing/)daha geniş bir düzeyde değerlendirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-381">Integration tests evaluate an app's components on a broader level than [unit tests](/dotnet/core/testing/).</span></span> <span data-ttu-id="b7c11-382">Birim testleri, ayrı sınıf yöntemleri gibi yalıtılmış yazılım bileşenlerini test etmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-382">Unit tests are used to test isolated software components, such as individual class methods.</span></span> <span data-ttu-id="b7c11-383">Tümleştirme testleri iki veya daha fazla uygulama bileşeninin beklenen bir sonuç üretmek için birlikte çalıştığını ve muhtemelen bir isteği tam olarak işlemek için gereken her bileşeni de dahil olduğunu onaylar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-383">Integration tests confirm that two or more app components work together to produce an expected result, possibly including every component required to fully process a request.</span></span>

<span data-ttu-id="b7c11-384">Bu geniş testler, uygulamanın altyapısını ve tüm çatısını test etmek için kullanılır, genellikle aşağıdaki bileşenler dahil:</span><span class="sxs-lookup"><span data-stu-id="b7c11-384">These broader tests are used to test the app's infrastructure and whole framework, often including the following components:</span></span>

* <span data-ttu-id="b7c11-385">Veritabanı</span><span class="sxs-lookup"><span data-stu-id="b7c11-385">Database</span></span>
* <span data-ttu-id="b7c11-386">Dosya sistemi</span><span class="sxs-lookup"><span data-stu-id="b7c11-386">File system</span></span>
* <span data-ttu-id="b7c11-387">Ağ gereçleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-387">Network appliances</span></span>
* <span data-ttu-id="b7c11-388">İstek-yanıt işlem hattı</span><span class="sxs-lookup"><span data-stu-id="b7c11-388">Request-response pipeline</span></span>

<span data-ttu-id="b7c11-389">Birim testleri, altyapı bileşenlerinin yerine, *Fakes* veya *sahte nesneler*olarak bilinen fabriccomponents bileşenlerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-389">Unit tests use fabricated components, known as *fakes* or *mock objects*, in place of infrastructure components.</span></span>

<span data-ttu-id="b7c11-390">Birim testlerinin aksine, tümleştirme testleri:</span><span class="sxs-lookup"><span data-stu-id="b7c11-390">In contrast to unit tests, integration tests:</span></span>

* <span data-ttu-id="b7c11-391">Uygulamanın üretimde kullandığı gerçek bileşenleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-391">Use the actual components that the app uses in production.</span></span>
* <span data-ttu-id="b7c11-392">Daha fazla kod ve veri işleme gerektir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-392">Require more code and data processing.</span></span>
* <span data-ttu-id="b7c11-393">Çalıştırmak daha uzun sürer.</span><span class="sxs-lookup"><span data-stu-id="b7c11-393">Take longer to run.</span></span>

<span data-ttu-id="b7c11-394">Bu nedenle, tümleştirme testlerinin kullanımını en önemli altyapı senaryolarıyla sınırlayın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-394">Therefore, limit the use of integration tests to the most important infrastructure scenarios.</span></span> <span data-ttu-id="b7c11-395">Bir davranış, birim testi veya tümleştirme testi kullanılarak test edilebilir ise, birim testini seçin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-395">If a behavior can be tested using either a unit test or an integration test, choose the unit test.</span></span>

> [!TIP]
> <span data-ttu-id="b7c11-396">Veritabanları ve dosya sistemleriyle ilgili her olası veri ve dosya erişimi için tümleştirme testleri yazma.</span><span class="sxs-lookup"><span data-stu-id="b7c11-396">Don't write integration tests for every possible permutation of data and file access with databases and file systems.</span></span> <span data-ttu-id="b7c11-397">Bir uygulamadaki kaç yerde veritabanlarıyla ve dosya sistemleriyle etkileşime girdiğinize bakılmaksızın, bir dizi Read, Write, Update ve DELETE tümleştirme testi, genellikle veritabanı ve dosya sistemi bileşenlerinin yeterli şekilde test edilmesine sahip olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-397">Regardless of how many places across an app interact with databases and file systems, a focused set of read, write, update, and delete integration tests are usually capable of adequately testing database and file system components.</span></span> <span data-ttu-id="b7c11-398">Bu bileşenlerle etkileşime geçen Yöntem mantığının rutin testleri için birim testleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-398">Use unit tests for routine tests of method logic that interact with these components.</span></span> <span data-ttu-id="b7c11-399">Birim testlerinde, altyapı kullanımı ve moizler 'in kullanılması daha hızlı test yürütmesiyle sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-399">In unit tests, the use of infrastructure fakes/mocks result in faster test execution.</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-400">Tümleştirme testlerinin tartışmalarında, test edilen proje genellikle *test altındaki sistem*veya kısa IÇIN "sut" olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-400">In discussions of integration tests, the tested project is frequently called the *System Under Test*, or "SUT" for short.</span></span>
>
> <span data-ttu-id="b7c11-401">*Bu konu başlığı altında, sınanan ASP.NET Core uygulamasına başvurmak için "SUT" kullanılır.*</span><span class="sxs-lookup"><span data-stu-id="b7c11-401">*"SUT" is used throughout this topic to refer to the tested ASP.NET Core app.*</span></span>

## <a name="aspnet-core-integration-tests"></a><span data-ttu-id="b7c11-402">ASP.NET Core tümleştirme testleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-402">ASP.NET Core integration tests</span></span>

<span data-ttu-id="b7c11-403">ASP.NET Core tümleştirme testleri şunları gerektirir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-403">Integration tests in ASP.NET Core require the following:</span></span>

* <span data-ttu-id="b7c11-404">Testleri içermesi ve yürütmek için bir test projesi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-404">A test project is used to contain and execute the tests.</span></span> <span data-ttu-id="b7c11-405">Test projesinin SUT 'a bir başvurusu vardır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-405">The test project has a reference to the SUT.</span></span>
* <span data-ttu-id="b7c11-406">Test projesi SUT için bir test Web Konağı oluşturur ve SUT ile istekleri ve yanıtları işlemek için bir test sunucusu istemcisi kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-406">The test project creates a test web host for the SUT and uses a test server client to handle requests and responses with the SUT.</span></span>
* <span data-ttu-id="b7c11-407">Test Çalıştırıcısı, testleri yürütmek ve test sonuçlarını raporlamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-407">A test runner is used to execute the tests and report the test results.</span></span>

<span data-ttu-id="b7c11-408">Tümleştirme testleri, olağan *düzenleme*, *hareket*ve *onaylama* testi adımlarını içeren bir olay dizisini izler:</span><span class="sxs-lookup"><span data-stu-id="b7c11-408">Integration tests follow a sequence of events that include the usual *Arrange*, *Act*, and *Assert* test steps:</span></span>

1. <span data-ttu-id="b7c11-409">SUT 'un web ana bilgisayarı yapılandırıldı.</span><span class="sxs-lookup"><span data-stu-id="b7c11-409">The SUT's web host is configured.</span></span>
1. <span data-ttu-id="b7c11-410">İstekleri uygulamaya göndermek için bir test sunucusu istemcisi oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-410">A test server client is created to submit requests to the app.</span></span>
1. <span data-ttu-id="b7c11-411">Testi *Düzenle* adımı yürütülür: test uygulaması bir istek hazırlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-411">The *Arrange* test step is executed: The test app prepares a request.</span></span>
1. <span data-ttu-id="b7c11-412">*Davran* test adımı yürütülür: istemci, isteği gönderir ve yanıtını alır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-412">The *Act* test step is executed: The client submits the request and receives the response.</span></span>
1. <span data-ttu-id="b7c11-413">*Onaylama* testi adımı yürütülür: *Gerçek* yanıt, *beklenen* bir yanıta bağlı olarak *başarılı* veya *başarısız* olarak onaylanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-413">The *Assert* test step is executed: The *actual* response is validated as a *pass* or *fail* based on an *expected* response.</span></span>
1. <span data-ttu-id="b7c11-414">İşlem, tüm testler yürütülene kadar devam eder.</span><span class="sxs-lookup"><span data-stu-id="b7c11-414">The process continues until all of the tests are executed.</span></span>
1. <span data-ttu-id="b7c11-415">Test sonuçları raporlanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-415">The test results are reported.</span></span>

<span data-ttu-id="b7c11-416">Genellikle, test Web ana bilgisayarı, test çalıştırmaları için uygulamanın normal web ana bilgisayarında farklı şekilde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-416">Usually, the test web host is configured differently than the app's normal web host for the test runs.</span></span> <span data-ttu-id="b7c11-417">Örneğin, testler için farklı bir veritabanı veya farklı uygulama ayarları kullanılıyor olabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-417">For example, a different database or different app settings might be used for the tests.</span></span>

<span data-ttu-id="b7c11-418">Test Web Konağı ve bellek içi test sunucusu ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)) gibi altyapı bileşenleri, [Microsoft. Aspnetcore. Mvc. Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paketi tarafından sağlanır veya yönetilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-418">Infrastructure components, such as the test web host and in-memory test server ([TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)), are provided or managed by the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package.</span></span> <span data-ttu-id="b7c11-419">Bu paketin kullanımı, test oluşturma ve yürütmeyi kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-419">Use of this package streamlines test creation and execution.</span></span>

<span data-ttu-id="b7c11-420">`Microsoft.AspNetCore.Mvc.Testing`Paket aşağıdaki görevleri gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-420">The `Microsoft.AspNetCore.Mvc.Testing` package handles the following tasks:</span></span>

* <span data-ttu-id="b7c11-421">Bağımlılıklar dosyasını (*. Deps*) sut 'den test projesinin *bin* dizinine kopyalar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-421">Copies the dependencies file (*.deps*) from the SUT into the test project's *bin* directory.</span></span>
* <span data-ttu-id="b7c11-422">, Testler yürütüldüğünde statik dosya ve sayfa/görünümlerin bulunması için [içerik kökünü](xref:fundamentals/index#content-root) sut 'nin proje köküne ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-422">Sets the [content root](xref:fundamentals/index#content-root) to the SUT's project root so that static files and pages/views are found when the tests are executed.</span></span>
* <span data-ttu-id="b7c11-423">, İle SUT önyükleyiciyi kolaylaştırmak için [Webapplicationfactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) sınıfını sağlar `TestServer` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-423">Provides the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) class to streamline bootstrapping the SUT with `TestServer`.</span></span>

<span data-ttu-id="b7c11-424">[Birim](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) testi belgeleri bir test projesi ve Test Çalıştırıcısı ayarlamayı ve testlerin ve test sınıflarının nasıl belirleneceğini gösteren testlerin ve önerilerin nasıl çalıştırılacağını gösteren ayrıntılı yönergelerle birlikte açıklanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-424">The [unit tests](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) documentation describes how to set up a test project and test runner, along with detailed instructions on how to run tests and recommendations for how to name tests and test classes.</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-425">Bir uygulama için test projesi oluştururken, birim testlerini tümleştirme testlerinden farklı projelere ayırın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-425">When creating a test project for an app, separate the unit tests from the integration tests into different projects.</span></span> <span data-ttu-id="b7c11-426">Bu, altyapı testi bileşenlerinin birim testlerine yanlışlıkla dahil olmamasını sağlamaya yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-426">This helps ensure that infrastructure testing components aren't accidentally included in the unit tests.</span></span> <span data-ttu-id="b7c11-427">Birim ve tümleştirme testlerinin ayrımı, hangi test kümesinin çalıştırılmasına da izin verir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-427">Separation of unit and integration tests also allows control over which set of tests are run.</span></span>

<span data-ttu-id="b7c11-428">Uygulamaların ve MVC uygulamalarının testleri için yapılandırma arasında neredeyse fark yoktur Razor .</span><span class="sxs-lookup"><span data-stu-id="b7c11-428">There's virtually no difference between the configuration for tests of Razor Pages apps and MVC apps.</span></span> <span data-ttu-id="b7c11-429">Tek fark testlerin adlandırılmasınlardır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-429">The only difference is in how the tests are named.</span></span> <span data-ttu-id="b7c11-430">Bir Razor Sayfalar uygulamasında sayfa uç noktalarının testleri genellikle sayfa modeli sınıfından sonra (örneğin, `IndexPageTests` Dizin sayfasına yönelik bileşen tümleştirmesini test etmek için) adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-430">In a Razor Pages app, tests of page endpoints are usually named after the page model class (for example, `IndexPageTests` to test component integration for the Index page).</span></span> <span data-ttu-id="b7c11-431">MVC uygulamasında, testler genellikle denetleyici sınıfları tarafından düzenlenir ve test ettikleri denetleyicilerde (örneğin, `HomeControllerTests` ana denetleyiciye yönelik bileşen tümleştirmesini test etmek için) adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-431">In an MVC app, tests are usually organized by controller classes and named after the controllers they test (for example, `HomeControllerTests` to test component integration for the Home controller).</span></span>

## <a name="test-app-prerequisites"></a><span data-ttu-id="b7c11-432">Test uygulaması önkoşulları</span><span class="sxs-lookup"><span data-stu-id="b7c11-432">Test app prerequisites</span></span>

<span data-ttu-id="b7c11-433">Test projesi şunları vermelidir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-433">The test project must:</span></span>

* <span data-ttu-id="b7c11-434">Aşağıdaki paketlere başvurun:</span><span class="sxs-lookup"><span data-stu-id="b7c11-434">Reference the following packages:</span></span>
  * [<span data-ttu-id="b7c11-435">Microsoft.AspNetCore.App</span><span class="sxs-lookup"><span data-stu-id="b7c11-435">Microsoft.AspNetCore.App</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.App/)
  * [<span data-ttu-id="b7c11-436">Microsoft. AspNetCore. Mvc. test</span><span class="sxs-lookup"><span data-stu-id="b7c11-436">Microsoft.AspNetCore.Mvc.Testing</span></span>](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing/)
* <span data-ttu-id="b7c11-437">() Proje dosyasında Web SDK 'sını belirtin `<Project Sdk="Microsoft.NET.Sdk.Web">` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-437">Specify the Web SDK in the project file (`<Project Sdk="Microsoft.NET.Sdk.Web">`).</span></span> <span data-ttu-id="b7c11-438">[Microsoft. AspNetCore. app metapackage](xref:fundamentals/metapackage-app)'e başvururken Web SDK 'sı gereklidir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-438">The Web SDK is required when referencing the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app).</span></span>

<span data-ttu-id="b7c11-439">Bu Önkoşullar [örnek uygulamada](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/)görülebilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-439">These prerequisites can be seen in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/).</span></span> <span data-ttu-id="b7c11-440">*Testler/ Razor pagesproject. Tests/ Razor pagesproject. Tests. csproj* dosyasını inceleyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-440">Inspect the *tests/RazorPagesProject.Tests/RazorPagesProject.Tests.csproj* file.</span></span> <span data-ttu-id="b7c11-441">Örnek uygulama, [xUnit](https://xunit.github.io/) test çerçevesini ve [anglesharp](https://anglesharp.github.io/) Parser kitaplığını kullanır, bu nedenle örnek uygulama de şu şekilde başvurur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-441">The sample app uses the [xUnit](https://xunit.github.io/) test framework and the [AngleSharp](https://anglesharp.github.io/) parser library, so the sample app also references:</span></span>

* [<span data-ttu-id="b7c11-442">xUnit</span><span class="sxs-lookup"><span data-stu-id="b7c11-442">xunit</span></span>](https://www.nuget.org/packages/xunit/)
* [<span data-ttu-id="b7c11-443">xUnit. Çalıştırıcısı. VisualStudio</span><span class="sxs-lookup"><span data-stu-id="b7c11-443">xunit.runner.visualstudio</span></span>](https://www.nuget.org/packages/xunit.runner.visualstudio/)
* [<span data-ttu-id="b7c11-444">AngleSharp</span><span class="sxs-lookup"><span data-stu-id="b7c11-444">AngleSharp</span></span>](https://www.nuget.org/packages/AngleSharp/)

## <a name="sut-environment"></a><span data-ttu-id="b7c11-445">SUT ortamı</span><span class="sxs-lookup"><span data-stu-id="b7c11-445">SUT environment</span></span>

<span data-ttu-id="b7c11-446">SUT [ortamı](xref:fundamentals/environments) ayarlanmamışsa, ortam varsayılan olarak geliştirme olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-446">If the SUT's [environment](xref:fundamentals/environments) isn't set, the environment defaults to Development.</span></span>

## <a name="basic-tests-with-the-default-webapplicationfactory"></a><span data-ttu-id="b7c11-447">Varsayılan WebApplicationFactory ile temel testler</span><span class="sxs-lookup"><span data-stu-id="b7c11-447">Basic tests with the default WebApplicationFactory</span></span>

<span data-ttu-id="b7c11-448">[Webapplicationfactory \<TEntryPoint> ](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) , tümleştirme testleri için bir [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) oluşturmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-448">[WebApplicationFactory\<TEntryPoint>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1) is used to create a [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) for the integration tests.</span></span> <span data-ttu-id="b7c11-449">`TEntryPoint`, genellikle sınıfının, SUT 'ın giriş noktası sınıfıdır `Startup` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-449">`TEntryPoint` is the entry point class of the SUT, usually the `Startup` class.</span></span>

<span data-ttu-id="b7c11-450">Test sınıfları sınıfı testlerin içerdiğini göstermek ve sınıftaki testler arasında paylaşılan nesne örnekleri sağlamak için bir *sınıf armatürü* arabirimi ([ıssfixture](https://xunit.github.io/docs/shared-context#class-fixture)) uygular.</span><span class="sxs-lookup"><span data-stu-id="b7c11-450">Test classes implement a *class fixture* interface ([IClassFixture](https://xunit.github.io/docs/shared-context#class-fixture)) to indicate the class contains tests and provide shared object instances across the tests in the class.</span></span>

<span data-ttu-id="b7c11-451">Aşağıdaki test sınıfı, `BasicTests` SUT 'yi önyüklemek `WebApplicationFactory` ve bir test yöntemine [HttpClient](/dotnet/api/system.net.http.httpclient) sağlamak için öğesini kullanır `Get_EndpointsReturnSuccessAndCorrectContentType` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-451">The following test class, `BasicTests`, uses the `WebApplicationFactory` to bootstrap the SUT and provide an [HttpClient](/dotnet/api/system.net.http.httpclient) to a test method, `Get_EndpointsReturnSuccessAndCorrectContentType`.</span></span> <span data-ttu-id="b7c11-452">Yöntemi, yanıt durum kodunun başarılı olup olmadığını denetler (200-299 aralığındaki durum kodları) ve `Content-Type` üst bilgi `text/html; charset=utf-8` birçok uygulama sayfasına yöneliktir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-452">The method checks if the response status code is successful (status codes in the range 200-299) and the `Content-Type` header is `text/html; charset=utf-8` for several app pages.</span></span>

<span data-ttu-id="b7c11-453">[Createclient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) , `HttpClient` yeniden yönlendirmeleri otomatik olarak izleyen ve tanımlama bilgilerini işleyen bir örneği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-453">[CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) creates an instance of `HttpClient` that automatically follows redirects and handles cookies.</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/BasicTests.cs?name=snippet1)]

<span data-ttu-id="b7c11-454">Varsayılan olarak, [GDPR onay ilkesi](xref:security/gdpr) etkinleştirildiğinde, önemli olmayan tanımlama bilgileri istekler arasında korunmaz.</span><span class="sxs-lookup"><span data-stu-id="b7c11-454">By default, non-essential cookies aren't preserved across requests when the [GDPR consent policy](xref:security/gdpr) is enabled.</span></span> <span data-ttu-id="b7c11-455">TempData sağlayıcısı tarafından kullanılanlar gibi, önemli olmayan tanımlama bilgilerini korumak için, bunları testlerinizde gerekli olarak işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-455">To preserve non-essential cookies, such as those used by the TempData provider, mark them as essential in your tests.</span></span> <span data-ttu-id="b7c11-456">Tanımlama bilgisini önemli olarak işaretleme hakkında yönergeler için bkz. [temel tanımlama bilgileri](xref:security/gdpr#essential-cookies).</span><span class="sxs-lookup"><span data-stu-id="b7c11-456">For instructions on marking a cookie as essential, see [Essential cookies](xref:security/gdpr#essential-cookies).</span></span>

## <a name="customize-webapplicationfactory"></a><span data-ttu-id="b7c11-457">WebApplicationFactory 'yi özelleştirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-457">Customize WebApplicationFactory</span></span>

<span data-ttu-id="b7c11-458">Web ana bilgisayar yapılandırması, öğesinden devralarak `WebApplicationFactory` bir veya daha fazla özel fabrika oluşturmak için test sınıflarından bağımsız olarak oluşturulabilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-458">Web host configuration can be created independently of the test classes by inheriting from `WebApplicationFactory` to create one or more custom factories:</span></span>

1. <span data-ttu-id="b7c11-459">`WebApplicationFactory` [Configurewebhost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost)'ten devralma ve geçersiz kılma.</span><span class="sxs-lookup"><span data-stu-id="b7c11-459">Inherit from `WebApplicationFactory` and override [ConfigureWebHost](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.configurewebhost).</span></span> <span data-ttu-id="b7c11-460">[Iwebhostbuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) , uygulama öncesinde yürütülen [ConfigureServices](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices)ile hizmet koleksiyonu yapılandırmasına izin verir `Startup.ConfigureServices` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-460">The [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) allows the configuration of the service collection with [ConfigureServices](/dotnet/api/microsoft.aspnetcore.hosting.istartup.configureservices), which is executed before the app's `Startup.ConfigureServices`.</span></span> <span data-ttu-id="b7c11-461">[Iwebhostbuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) , [configuretestservices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices)ile hizmet koleksiyonundaki kayıtlı hizmetlerin üzerine yazma ve değiştirme olanağı sağlar:</span><span class="sxs-lookup"><span data-stu-id="b7c11-461">The [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) allows overriding and modifying registered services in the service collection with [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices):</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/CustomWebApplicationFactory.cs?name=snippet1)]

   <span data-ttu-id="b7c11-462">[Örnek uygulamadaki](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) veritabanı dengeli dağıtımı, yöntemi tarafından gerçekleştirilir `InitializeDbForTests` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-462">Database seeding in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) is performed by the `InitializeDbForTests` method.</span></span> <span data-ttu-id="b7c11-463">Yöntemi, [tümleştirme testleri örneği: test uygulaması kuruluşu](#test-app-organization) bölümünde açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-463">The method is described in the [Integration tests sample: Test app organization](#test-app-organization) section.</span></span>

2. <span data-ttu-id="b7c11-464">Özel `CustomWebApplicationFactory` Test sınıflarında kullanın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-464">Use the custom `CustomWebApplicationFactory` in test classes.</span></span> <span data-ttu-id="b7c11-465">Aşağıdaki örnek, sınıfında fabrikası kullanır `IndexPageTests` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-465">The following example uses the factory in the `IndexPageTests` class:</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet1)]

   <span data-ttu-id="b7c11-466">Örnek uygulamanın istemcisi, aşağıdaki yeniden yönlendirmeleri engelleyecek şekilde yapılandırılmıştır `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-466">The sample app's client is configured to prevent the `HttpClient` from following redirects.</span></span> <span data-ttu-id="b7c11-467">Daha sonra, [sahte kimlik doğrulama](#mock-authentication) bölümünde açıklandığı gibi, bu, testlerin uygulamanın ilk yanıtının sonucunu denetlemesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-467">As explained later in the [Mock authentication](#mock-authentication) section, this permits tests to check the result of the app's first response.</span></span> <span data-ttu-id="b7c11-468">İlk yanıt, bu testlerin çoğunda üst bilgiyle bir yeniden yönlendirmelidir `Location` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-468">The first response is a redirect in many of these tests with a `Location` header.</span></span>

3. <span data-ttu-id="b7c11-469">Tipik bir test, `HttpClient` isteği ve yanıtı işlemek için ve yardımcı yöntemlerini kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-469">A typical test uses the `HttpClient` and helper methods to process the request and the response:</span></span>

   [!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="b7c11-470">SUT 'a yönelik herhangi bir POST isteği, uygulamanın [veri koruma antiforgery sistemi](xref:security/data-protection/introduction)tarafından otomatik olarak oluşturulan antiforgery denetimini karşılamalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-470">Any POST request to the SUT must satisfy the antiforgery check that's automatically made by the app's [data protection antiforgery system](xref:security/data-protection/introduction).</span></span> <span data-ttu-id="b7c11-471">Bir testin POST isteğini düzenlemek için test uygulaması şunları kullanmalıdır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-471">In order to arrange for a test's POST request, the test app must:</span></span>

1. <span data-ttu-id="b7c11-472">Sayfa için bir istek oluşturun.</span><span class="sxs-lookup"><span data-stu-id="b7c11-472">Make a request for the page.</span></span>
1. <span data-ttu-id="b7c11-473">Antiforgery tanımlama bilgisini ayrıştırın ve yanıt doğrulama belirtecini istekten isteyin.</span><span class="sxs-lookup"><span data-stu-id="b7c11-473">Parse the antiforgery cookie and request validation token from the response.</span></span>
1. <span data-ttu-id="b7c11-474">POST isteğini, antiforgery tanımlama bilgisiyle ve istek doğrulama belirteciyle birlikte yapın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-474">Make the POST request with the antiforgery cookie and request validation token in place.</span></span>

<span data-ttu-id="b7c11-475">`SendAsync`Örnek uygulamadaki yardımcı uzantı yöntemleri (*yardımcılar/Httpclienconversionsions. cs*) ve `GetDocumentAsync` yardımcı yöntemi (*yardımcılar/htmlyardımcıları. cs*), aşağıdaki [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/) yöntemlerle Antiforgery denetimini işlemek için [anglesharp](https://anglesharp.github.io/) ayrıştırıcısını kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-475">The `SendAsync` helper extension methods (*Helpers/HttpClientExtensions.cs*) and the `GetDocumentAsync` helper method (*Helpers/HtmlHelpers.cs*) in the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/) use the [AngleSharp](https://anglesharp.github.io/) parser to handle the antiforgery check with the following methods:</span></span>

* <span data-ttu-id="b7c11-476">`GetDocumentAsync`: [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) 'ı alır ve döndürür `IHtmlDocument` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-476">`GetDocumentAsync`: Receives the [HttpResponseMessage](/dotnet/api/system.net.http.httpresponsemessage) and returns an `IHtmlDocument`.</span></span> <span data-ttu-id="b7c11-477">`GetDocumentAsync`, orijinalin temelinde bir *sanal yanıt* hazırlayan bir fabrika kullanır `HttpResponseMessage` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-477">`GetDocumentAsync` uses a factory that prepares a *virtual response* based on the original `HttpResponseMessage`.</span></span> <span data-ttu-id="b7c11-478">Daha fazla bilgi için bkz. [Anglesharp belgeleri](https://github.com/AngleSharp/AngleSharp#documentation).</span><span class="sxs-lookup"><span data-stu-id="b7c11-478">For more information, see the [AngleSharp documentation](https://github.com/AngleSharp/AngleSharp#documentation).</span></span>
* <span data-ttu-id="b7c11-479">`SendAsync``HttpClient`bir [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) oluşturun ve istekleri sut 'A göndermek Için [Sendadsync (HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) çağrısı yapın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-479">`SendAsync` extension methods for the `HttpClient` compose an [HttpRequestMessage](/dotnet/api/system.net.http.httprequestmessage) and call [SendAsync(HttpRequestMessage)](/dotnet/api/system.net.http.httpclient.sendasync#System_Net_Http_HttpClient_SendAsync_System_Net_Http_HttpRequestMessage_) to submit requests to the SUT.</span></span> <span data-ttu-id="b7c11-480">`SendAsync`HTML biçimini kabul etmek için aşırı yüklemeler ( `IHtmlFormElement` ) ve şunları yapın:</span><span class="sxs-lookup"><span data-stu-id="b7c11-480">Overloads for `SendAsync` accept the HTML form (`IHtmlFormElement`) and the following:</span></span>
  * <span data-ttu-id="b7c11-481">Formun () Gönder düğmesi `IHtmlElement`</span><span class="sxs-lookup"><span data-stu-id="b7c11-481">Submit button of the form (`IHtmlElement`)</span></span>
  * <span data-ttu-id="b7c11-482">Form değerleri koleksiyonu ( `IEnumerable<KeyValuePair<string, string>>` )</span><span class="sxs-lookup"><span data-stu-id="b7c11-482">Form values collection (`IEnumerable<KeyValuePair<string, string>>`)</span></span>
  * <span data-ttu-id="b7c11-483">Düğme ( `IHtmlElement` ) ve form değerlerini ( `IEnumerable<KeyValuePair<string, string>>` ) gönder</span><span class="sxs-lookup"><span data-stu-id="b7c11-483">Submit button (`IHtmlElement`) and form values (`IEnumerable<KeyValuePair<string, string>>`)</span></span>

> [!NOTE]
> <span data-ttu-id="b7c11-484">[Anglesharp](https://anglesharp.github.io/) , bu konuda ve örnek uygulamada Gösterim amacıyla kullanılan bir üçüncü taraf ayrıştırma kitaplığıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-484">[AngleSharp](https://anglesharp.github.io/) is a third-party parsing library used for demonstration purposes in this topic and the sample app.</span></span> <span data-ttu-id="b7c11-485">ASP.NET Core uygulamalarının tümleştirme testi için AngleSharp desteklenmez veya gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-485">AngleSharp isn't supported or required for integration testing of ASP.NET Core apps.</span></span> <span data-ttu-id="b7c11-486">Diğer çözümleyiciler, [HTML çevikliği paketi (HAP)](https://html-agility-pack.net/)gibi kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-486">Other parsers can be used, such as the [Html Agility Pack (HAP)](https://html-agility-pack.net/).</span></span> <span data-ttu-id="b7c11-487">Diğer bir yaklaşım ise, antiforgery sisteminin istek doğrulama belirtecini ve antiforgery tanımlama bilgisini doğrudan işlemek için kod yazmaktır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-487">Another approach is to write code to handle the antiforgery system's request verification token and antiforgery cookie directly.</span></span>

## <a name="customize-the-client-with-withwebhostbuilder"></a><span data-ttu-id="b7c11-488">WithWebHostBuilder ile istemciyi özelleştirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-488">Customize the client with WithWebHostBuilder</span></span>

<span data-ttu-id="b7c11-489">Bir test yönteminde ek yapılandırma gerektiğinde, [Withwebhostbuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) , `WebApplicationFactory` yapılandırmaya göre daha fazla özelleştirilmiş bir [ıwebhostbuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) ile yeni bir oluşturur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-489">When additional configuration is required within a test method, [WithWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.withwebhostbuilder) creates a new `WebApplicationFactory` with an [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) that is further customized by configuration.</span></span>

<span data-ttu-id="b7c11-490">`Post_DeleteMessageHandler_ReturnsRedirectToRoot` [Örnek uygulamanın](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) test yöntemi öğesinin kullanımını gösterir `WithWebHostBuilder` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-490">The `Post_DeleteMessageHandler_ReturnsRedirectToRoot` test method of the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) demonstrates the use of `WithWebHostBuilder`.</span></span> <span data-ttu-id="b7c11-491">Bu test, SUT 'da form gönderimini tetikleyerek veritabanında silme işlemini gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-491">This test performs a record delete in the database by triggering a form submission in the SUT.</span></span>

<span data-ttu-id="b7c11-492">Sınıftaki başka bir test `IndexPageTests` veritabanındaki tüm kayıtları silen ve yönteminden önce çalışabilen bir işlem gerçekleştirdiğinden `Post_DeleteMessageHandler_ReturnsRedirectToRoot` , sut 'in silinmesine yönelik bir kaydın mevcut olduğundan emin olmak için veritabanı bu test yönteminde yeniden uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-492">Because another test in the `IndexPageTests` class performs an operation that deletes all of the records in the database and may run before the `Post_DeleteMessageHandler_ReturnsRedirectToRoot` method, the database is reseeded in this test method to ensure that a record is present for the SUT to delete.</span></span> <span data-ttu-id="b7c11-493">SUT içindeki formun ilk Sil düğmesini seçmek, `messages` sut isteğine göre benzetilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-493">Selecting the first delete button of the `messages` form in the SUT is simulated in the request to the SUT:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet3)]

## <a name="client-options"></a><span data-ttu-id="b7c11-494">İstemci seçenekleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-494">Client options</span></span>

<span data-ttu-id="b7c11-495">Aşağıdaki tabloda, örnek oluştururken kullanılabilen varsayılan [Webapplicationfactoryclientoptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) gösterilmektedir `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-495">The following table shows the default [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) available when creating `HttpClient` instances.</span></span>

| <span data-ttu-id="b7c11-496">Seçenek</span><span class="sxs-lookup"><span data-stu-id="b7c11-496">Option</span></span> | <span data-ttu-id="b7c11-497">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-497">Description</span></span> | <span data-ttu-id="b7c11-498">Varsayılan</span><span class="sxs-lookup"><span data-stu-id="b7c11-498">Default</span></span> |
| ------ | ----------- | ------- |
| [<span data-ttu-id="b7c11-499">Allowoto yeniden yönlendirme</span><span class="sxs-lookup"><span data-stu-id="b7c11-499">AllowAutoRedirect</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) | <span data-ttu-id="b7c11-500">`HttpClient`Örneklerin otomatik olarak yeniden yönlendirme yanıtlarını izleyip izmeyeceğini alır veya ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-500">Gets or sets whether or not `HttpClient` instances should automatically follow redirect responses.</span></span> | `true` |
| [<span data-ttu-id="b7c11-501">BaseAddress</span><span class="sxs-lookup"><span data-stu-id="b7c11-501">BaseAddress</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.baseaddress) | <span data-ttu-id="b7c11-502">Örneklerin temel adresini alır veya ayarlar `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-502">Gets or sets the base address of `HttpClient` instances.</span></span> | `http://localhost` |
| [<span data-ttu-id="b7c11-503">HandleCookies</span><span class="sxs-lookup"><span data-stu-id="b7c11-503">HandleCookies</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.handlecookies) | <span data-ttu-id="b7c11-504">`HttpClient`Örneklerin tanımlama bilgilerini işlemesinin gerekip gerekmediğini alır veya ayarlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-504">Gets or sets whether `HttpClient` instances should handle cookies.</span></span> | `true` |
| [<span data-ttu-id="b7c11-505">Maxautomaticyönlendirmeler</span><span class="sxs-lookup"><span data-stu-id="b7c11-505">MaxAutomaticRedirections</span></span>](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.maxautomaticredirections) | <span data-ttu-id="b7c11-506">Örneklerin izlemesi gereken en fazla yeniden yönlendirme yanıtı sayısını alır veya ayarlar `HttpClient` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-506">Gets or sets the maximum number of redirect responses that `HttpClient` instances should follow.</span></span> | <span data-ttu-id="b7c11-507">7</span><span class="sxs-lookup"><span data-stu-id="b7c11-507">7</span></span> |

<span data-ttu-id="b7c11-508">Sınıfını oluşturun `WebApplicationFactoryClientOptions` ve [createclient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) yöntemine geçirin (varsayılan değerler kod örneğinde gösterilir):</span><span class="sxs-lookup"><span data-stu-id="b7c11-508">Create the `WebApplicationFactoryClientOptions` class and pass it to the [CreateClient](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createclient) method (default values are shown in the code example):</span></span>

```csharp
// Default client option values are shown
var clientOptions = new WebApplicationFactoryClientOptions();
clientOptions.AllowAutoRedirect = true;
clientOptions.BaseAddress = new Uri("http://localhost");
clientOptions.HandleCookies = true;
clientOptions.MaxAutomaticRedirections = 7;

_client = _factory.CreateClient(clientOptions);
```

## <a name="inject-mock-services"></a><span data-ttu-id="b7c11-509">Sahte hizmetler ekleme</span><span class="sxs-lookup"><span data-stu-id="b7c11-509">Inject mock services</span></span>

<span data-ttu-id="b7c11-510">Hizmetler, ana bilgisayar tasarımcısında [Configuretestservices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) çağrısıyla bir testte geçersiz kılınabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-510">Services can be overridden in a test with a call to [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) on the host builder.</span></span> <span data-ttu-id="b7c11-511">**Sahte hizmetleri eklemek için SUT, `Startup` yöntemi olan bir sınıfa sahip olmalıdır `Startup.ConfigureServices` .**</span><span class="sxs-lookup"><span data-stu-id="b7c11-511">**To inject mock services, the SUT must have a `Startup` class with a `Startup.ConfigureServices` method.**</span></span>

<span data-ttu-id="b7c11-512">Örnek SUT, bir teklif döndüren kapsamlı bir hizmet içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-512">The sample SUT includes a scoped service that returns a quote.</span></span> <span data-ttu-id="b7c11-513">Dizin sayfası istendiğinde, teklif Dizin sayfasındaki gizli bir alana katıştırılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-513">The quote is embedded in a hidden field on the Index page when the Index page is requested.</span></span>

<span data-ttu-id="b7c11-514">*Hizmetler/ıquoteservice. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-514">*Services/IQuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Services/IQuoteService.cs?name=snippet1)]

<span data-ttu-id="b7c11-515">*Hizmetler/QuoteService. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-515">*Services/QuoteService.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Services/QuoteService.cs?name=snippet1)]

<span data-ttu-id="b7c11-516">*Startup.cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-516">*Startup.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet2)]

<span data-ttu-id="b7c11-517">*Pages/Index. cshtml. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-517">*Pages/Index.cshtml.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml.cs?name=snippet1&highlight=4,9,20,26)]

<span data-ttu-id="b7c11-518">*Sayfa/dizin. cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-518">*Pages/Index.cs*:</span></span>

[!code-cshtml[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Pages/Index.cshtml?name=snippet_Quote)]

<span data-ttu-id="b7c11-519">Aşağıdaki biçimlendirme, SUT uygulaması çalıştırıldığında oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-519">The following markup is generated when the SUT app is run:</span></span>

```html
<input id="quote" type="hidden" value="Come on, Sarah. We&#x27;ve an appointment in 
    London, and we&#x27;re already 30,000 years late.">
```

<span data-ttu-id="b7c11-520">Bir tümleştirme testinde hizmet ve teklif ekleme işlemini test etmek için, test tarafından SUT 'ye bir sahte hizmet eklenir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-520">To test the service and quote injection in an integration test, a mock service is injected into the SUT by the test.</span></span> <span data-ttu-id="b7c11-521">Sahte hizmet, uygulamanın `QuoteService` adı verilen test uygulaması tarafından verilen bir hizmetle değiştirilir `TestQuoteService` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-521">The mock service replaces the app's `QuoteService` with a service provided by the test app, called `TestQuoteService`:</span></span>

<span data-ttu-id="b7c11-522">*IntegrationTests.IndexPageTests.cs*:</span><span class="sxs-lookup"><span data-stu-id="b7c11-522">*IntegrationTests.IndexPageTests.cs*:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet4)]

<span data-ttu-id="b7c11-523">`ConfigureTestServices`çağrılır ve kapsamlı hizmet kaydedilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-523">`ConfigureTestServices` is called, and the scoped service is registered:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/IndexPageTests.cs?name=snippet5&highlight=7-10,17,20-21)]

<span data-ttu-id="b7c11-524">Testin yürütülmesi sırasında üretilen biçimlendirme tarafından sağlanan teklif metnini yansıtır `TestQuoteService` , bu nedenle onaylama işlemi geçer:</span><span class="sxs-lookup"><span data-stu-id="b7c11-524">The markup produced during the test's execution reflects the quote text supplied by `TestQuoteService`, thus the assertion passes:</span></span>

```html
<input id="quote" type="hidden" value="Something&#x27;s interfering with time, 
    Mr. Scarman, and time is my business.">
```

## <a name="mock-authentication"></a><span data-ttu-id="b7c11-525">Sahte kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="b7c11-525">Mock authentication</span></span>

<span data-ttu-id="b7c11-526">`AuthTests`Sınıftaki testler güvenli bir uç noktanın bulunup bulunmadığını denetler:</span><span class="sxs-lookup"><span data-stu-id="b7c11-526">Tests in the `AuthTests` class check that a secure endpoint:</span></span>

* <span data-ttu-id="b7c11-527">Kimliği doğrulanmamış bir kullanıcıyı uygulamanın oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-527">Redirects an unauthenticated user to the app's Login page.</span></span>
* <span data-ttu-id="b7c11-528">Kimliği doğrulanmış bir kullanıcı için içerik döndürür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-528">Returns content for an authenticated user.</span></span>

<span data-ttu-id="b7c11-529">SUT sayfasında, sayfada bir `/SecurePage` [Authorizefilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) uygulamak için Bu sayfa bir [authorizepage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) kuralı kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-529">In the SUT, the `/SecurePage` page uses an [AuthorizePage](/dotnet/api/microsoft.extensions.dependencyinjection.pageconventioncollectionextensions.authorizepage) convention to apply an [AuthorizeFilter](/dotnet/api/microsoft.aspnetcore.mvc.authorization.authorizefilter) to the page.</span></span> <span data-ttu-id="b7c11-530">Daha fazla bilgi için bkz. [ Razor Sayfalar yetkilendirme kuralları](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span><span class="sxs-lookup"><span data-stu-id="b7c11-530">For more information, see [Razor Pages authorization conventions](xref:security/authorization/razor-pages-authorization#require-authorization-to-access-a-page).</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/src/RazorPagesProject/Startup.cs?name=snippet1)]

<span data-ttu-id="b7c11-531">`Get_SecurePageRedirectsAnUnauthenticatedUser`Testte, bir [Webapplicationfactoryclientoptions, Allowclıredirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) ' i ayarlayarak [yeniden](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) yönlendirmeye izin vermez olarak ayarlanır `false` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-531">In the `Get_SecurePageRedirectsAnUnauthenticatedUser` test, a [WebApplicationFactoryClientOptions](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions) is set to disallow redirects by setting [AllowAutoRedirect](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactoryclientoptions.allowautoredirect) to `false`:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet2)]

<span data-ttu-id="b7c11-532">İstemcinin yeniden yönlendirmeyi izlemeye izin vererek aşağıdaki denetimler yapılabilir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-532">By disallowing the client to follow the redirect, the following checks can be made:</span></span>

* <span data-ttu-id="b7c11-533">SUT tarafından döndürülen durum kodu, oturum açma sayfasına yeniden yönlendirmeden sonra, [HttpStatusCode. Tamam](/dotnet/api/system.net.httpstatuscode)olacak şekilde, son durum koduna değil beklenen [HttpStatusCode. Redirect](/dotnet/api/system.net.httpstatuscode) sonucuyla denetlenebilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-533">The status code returned by the SUT can be checked against the expected [HttpStatusCode.Redirect](/dotnet/api/system.net.httpstatuscode) result, not the final status code after the redirect to the Login page, which would be [HttpStatusCode.OK](/dotnet/api/system.net.httpstatuscode).</span></span>
* <span data-ttu-id="b7c11-534">`Location`Yanıt üst bilgilerindeki üst bilgi değeri, `http://localhost/Identity/Account/Login` üst bilgi bulunmayan son oturum açma sayfası yanıtı değil, ile başladığı onaylanacak şekilde denetlenir `Location` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-534">The `Location` header value in the response headers is checked to confirm that it starts with `http://localhost/Identity/Account/Login`, not the final Login page response, where the `Location` header wouldn't be present.</span></span>

<span data-ttu-id="b7c11-535">Test uygulaması, <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> kimlik doğrulama ve yetkilendirme işlemlerini test etmek için bir [Configuretestservices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) içinde bir model oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-535">The test app can mock an <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> in [ConfigureTestServices](/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestservices) in order to test aspects of authentication and authorization.</span></span> <span data-ttu-id="b7c11-536">En az bir senaryo, bir [kimlik doğrulayan Poesult. Success](xref:Microsoft.AspNetCore.Authentication.AuthenticateResult.Success*)döndürür:</span><span class="sxs-lookup"><span data-stu-id="b7c11-536">A minimal scenario returns an [AuthenticateResult.Success](xref:Microsoft.AspNetCore.Authentication.AuthenticateResult.Success*):</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet4&highlight=11-18)]

<span data-ttu-id="b7c11-537">, `TestAuthHandler` Kimlik doğrulama şeması, için kaydedildiği yere ayarlandığında bir kullanıcının kimliğini doğrulamak için `Test` çağrılır `AddAuthentication` `ConfigureTestServices` :</span><span class="sxs-lookup"><span data-stu-id="b7c11-537">The `TestAuthHandler` is called to authenticate a user when the authentication scheme is set to `Test` where `AddAuthentication` is registered for `ConfigureTestServices`:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/IntegrationTests/AuthTests.cs?name=snippet3&highlight=7-12)]

<span data-ttu-id="b7c11-538">Hakkında daha fazla bilgi için `WebApplicationFactoryClientOptions` [istemci seçenekleri](#client-options) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-538">For more information on `WebApplicationFactoryClientOptions`, see the [Client options](#client-options) section.</span></span>

## <a name="set-the-environment"></a><span data-ttu-id="b7c11-539">Ortamı ayarlama</span><span class="sxs-lookup"><span data-stu-id="b7c11-539">Set the environment</span></span>

<span data-ttu-id="b7c11-540">Varsayılan olarak, SUT 'nin ana bilgisayar ve uygulama ortamı geliştirme ortamını kullanacak şekilde yapılandırılmıştır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-540">By default, the SUT's host and app environment is configured to use the Development environment.</span></span> <span data-ttu-id="b7c11-541">SUT ortamını geçersiz kılmak için:</span><span class="sxs-lookup"><span data-stu-id="b7c11-541">To override the SUT's environment:</span></span>

* <span data-ttu-id="b7c11-542">`ASPNETCORE_ENVIRONMENT`Ortam değişkenini (örneğin,,, `Staging` veya gibi `Production` başka bir özel değeri `Testing` ) ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-542">Set the `ASPNETCORE_ENVIRONMENT` environment variable (for example, `Staging`, `Production`, or other custom value, such as `Testing`).</span></span>
* <span data-ttu-id="b7c11-543">`CreateWebHostBuilder`Ortam değişkenini okumak için test uygulaması içinde geçersiz kılın `ASPNETCORE_ENVIRONMENT` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-543">Override `CreateWebHostBuilder` in the test app to read the `ASPNETCORE_ENVIRONMENT` environment variable.</span></span>

```csharp
public class CustomWebApplicationFactory<TStartup> 
    : WebApplicationFactory<TStartup> where TStartup: class
{
    protected override IWebHostBuilder CreateWebHostBuilder()
    {
        return base.CreateWebHostBuilder()
            .UseEnvironment(
                Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT"));
    }

    ...
}
```

<span data-ttu-id="b7c11-544">Ortam ayrıca doğrudan konak Oluşturucu üzerinde özel olarak ayarlanabilir <xref:Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory%601> :</span><span class="sxs-lookup"><span data-stu-id="b7c11-544">The environment can also be set directly on the host builder in a custom <xref:Microsoft.AspNetCore.Mvc.Testing.WebApplicationFactory%601>:</span></span>

```csharp
public class CustomWebApplicationFactory<TStartup> 
    : WebApplicationFactory<TStartup> where TStartup: class
{
    protected override void ConfigureWebHost(IWebHostBuilder builder)
    {
        builder.UseEnvironment(
            Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT"));
    
        ...
    }

    ...
```

## <a name="how-the-test-infrastructure-infers-the-app-content-root-path"></a><span data-ttu-id="b7c11-545">Test altyapısının uygulama içeriği kök yolunu nasıl öğrendiğini</span><span class="sxs-lookup"><span data-stu-id="b7c11-545">How the test infrastructure infers the app content root path</span></span>

<span data-ttu-id="b7c11-546">`WebApplicationFactory`Oluşturucu, derleme üzerinde bir anahtarla eşit anahtar olan tümleştirme testlerini içeren bir [Webapplicationfactorycontentrootattribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) arayarak uygulama [içeriği kök](xref:fundamentals/index#content-root) yolunu alır `TEntryPoint` `System.Reflection.Assembly.FullName` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-546">The `WebApplicationFactory` constructor infers the app [content root](xref:fundamentals/index#content-root) path by searching for a [WebApplicationFactoryContentRootAttribute](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactorycontentrootattribute) on the assembly containing the integration tests with a key equal to the `TEntryPoint` assembly `System.Reflection.Assembly.FullName`.</span></span> <span data-ttu-id="b7c11-547">Doğru anahtara sahip bir özniteliğin bulunamaması durumunda, `WebApplicationFactory` bir çözüm dosyası (*. sln*) aramaya geri döner ve `TEntryPoint` derleme adını çözüm dizinine ekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-547">In case an attribute with the correct key isn't found, `WebApplicationFactory` falls back to searching for a solution file (*.sln*) and appends the `TEntryPoint` assembly name to the solution directory.</span></span> <span data-ttu-id="b7c11-548">Uygulama kök dizini (içerik kök yolu) görünümleri ve içerik dosyalarını saptamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-548">The app root directory (the content root path) is used to discover views and content files.</span></span>

## <a name="disable-shadow-copying"></a><span data-ttu-id="b7c11-549">Gölge kopyalamayı devre dışı bırak</span><span class="sxs-lookup"><span data-stu-id="b7c11-549">Disable shadow copying</span></span>

<span data-ttu-id="b7c11-550">Gölge kopyalama, testlerin çıkış dizininden farklı bir dizinde yürütülmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="b7c11-550">Shadow copying causes the tests to execute in a different directory than the output directory.</span></span> <span data-ttu-id="b7c11-551">Testlerin düzgün çalışması için gölge kopyalama devre dışı bırakılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-551">For tests to work properly, shadow copying must be disabled.</span></span> <span data-ttu-id="b7c11-552">[Örnek uygulama](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) xUnit kullanır ve doğru yapılandırma ayarıyla bir *xunit.runner.js* dosyaya ekleyerek xUnit için gölge kopyalamayı devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-552">The [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) uses xUnit and disables shadow copying for xUnit by including an *xunit.runner.json* file with the correct configuration setting.</span></span> <span data-ttu-id="b7c11-553">Daha fazla bilgi için bkz. [JSON Ile xUnit yapılandırma](https://xunit.github.io/docs/configuring-with-json.html).</span><span class="sxs-lookup"><span data-stu-id="b7c11-553">For more information, see [Configuring xUnit with JSON](https://xunit.github.io/docs/configuring-with-json.html).</span></span>

<span data-ttu-id="b7c11-554">Aşağıdaki içeriğe sahip test projesinin köküne dosya *xunit.runner.js* ekleyin:</span><span class="sxs-lookup"><span data-stu-id="b7c11-554">Add the *xunit.runner.json* file to root of the test project with the following content:</span></span>

```json
{
  "shadowCopy": false
}
```

<span data-ttu-id="b7c11-555">Visual Studio kullanıyorsanız, dosyanın **Çıkış Dizinine Kopyala** özelliğini **her zaman Kopyala**olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-555">If using Visual Studio, set the file's **Copy to Output Directory** property to **Copy always**.</span></span> <span data-ttu-id="b7c11-556">Visual Studio kullanmıyorsanız, `Content` Test uygulamasının proje dosyasına bir hedef ekleyin:</span><span class="sxs-lookup"><span data-stu-id="b7c11-556">If not using Visual Studio, add a `Content` target to the test app's project file:</span></span>

```xml
<ItemGroup>
  <Content Update="xunit.runner.json">
    <CopyToOutputDirectory>Always</CopyToOutputDirectory>
  </Content>
</ItemGroup>
```

## <a name="disposal-of-objects"></a><span data-ttu-id="b7c11-557">Nesnelerin elden çıkarılması</span><span class="sxs-lookup"><span data-stu-id="b7c11-557">Disposal of objects</span></span>

<span data-ttu-id="b7c11-558">`IClassFixture`Uygulamanın testleri yürütüldükten sonra, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) ve [HttpClient](/dotnet/api/system.net.http.httpclient) , [webapplicationfactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1)'nin xUnit 'i çıkardığı zaman yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-558">After the tests of the `IClassFixture` implementation are executed, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver) and [HttpClient](/dotnet/api/system.net.http.httpclient) are disposed when xUnit disposes of the [WebApplicationFactory](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1).</span></span> <span data-ttu-id="b7c11-559">Geliştirici tarafından oluşturulan nesneler elden çıkarma gerektiriyorsa, bunları `IClassFixture` uygulamada atın.</span><span class="sxs-lookup"><span data-stu-id="b7c11-559">If objects instantiated by the developer require disposal, dispose of them in the `IClassFixture` implementation.</span></span> <span data-ttu-id="b7c11-560">Daha fazla bilgi için bkz. [Dispose yöntemi uygulama](/dotnet/standard/garbage-collection/implementing-dispose).</span><span class="sxs-lookup"><span data-stu-id="b7c11-560">For more information, see [Implementing a Dispose method](/dotnet/standard/garbage-collection/implementing-dispose).</span></span>

## <a name="integration-tests-sample"></a><span data-ttu-id="b7c11-561">Tümleştirme Testleri örneği</span><span class="sxs-lookup"><span data-stu-id="b7c11-561">Integration tests sample</span></span>

<span data-ttu-id="b7c11-562">[Örnek uygulama](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) iki uygulamalardan oluşur:</span><span class="sxs-lookup"><span data-stu-id="b7c11-562">The [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples) is composed of two apps:</span></span>

| <span data-ttu-id="b7c11-563">Uygulama</span><span class="sxs-lookup"><span data-stu-id="b7c11-563">App</span></span> | <span data-ttu-id="b7c11-564">Proje dizini</span><span class="sxs-lookup"><span data-stu-id="b7c11-564">Project directory</span></span> | <span data-ttu-id="b7c11-565">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-565">Description</span></span> |
| --- | ----------------- | ----------- |
| <span data-ttu-id="b7c11-566">İleti uygulaması (SUT)</span><span class="sxs-lookup"><span data-stu-id="b7c11-566">Message app (the SUT)</span></span> | <span data-ttu-id="b7c11-567">*src/ Razor pagesproject*</span><span class="sxs-lookup"><span data-stu-id="b7c11-567">*src/RazorPagesProject*</span></span> | <span data-ttu-id="b7c11-568">Bir kullanıcının, iletileri eklemesini, silmesini, silmesini ve analiz etmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-568">Allows a user to add, delete one, delete all, and analyze messages.</span></span> |
| <span data-ttu-id="b7c11-569">Test uygulaması</span><span class="sxs-lookup"><span data-stu-id="b7c11-569">Test app</span></span> | <span data-ttu-id="b7c11-570">*testler/ Razor pagesproject. Tests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-570">*tests/RazorPagesProject.Tests*</span></span> | <span data-ttu-id="b7c11-571">SUT test tümleştirmesi için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-571">Used to integration test the SUT.</span></span> |

<span data-ttu-id="b7c11-572">Testler, [Visual Studio](https://visualstudio.microsoft.com)gıbı bir IDE 'nin yerleşik test özellikleri kullanılarak çalıştırılabilir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-572">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](https://visualstudio.microsoft.com).</span></span> <span data-ttu-id="b7c11-573">[Visual Studio Code](https://code.visualstudio.com/) veya komut satırı kullanıyorsanız, *testler/ Razor pagesproject. Tests* dizinindeki bir komut isteminde aşağıdaki komutu yürütün:</span><span class="sxs-lookup"><span data-stu-id="b7c11-573">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesProject.Tests* directory:</span></span>

```dotnetcli
dotnet test
```

### <a name="message-app-sut-organization"></a><span data-ttu-id="b7c11-574">İleti uygulaması (SUT) kuruluşu</span><span class="sxs-lookup"><span data-stu-id="b7c11-574">Message app (SUT) organization</span></span>

<span data-ttu-id="b7c11-575">SUT, Razor aşağıdaki özelliklere sahip bir sayfalar ileti sistemidir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-575">The SUT is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="b7c11-576">Uygulamanın (*Pages/Index. cshtml* ve *Pages/index. cshtml. cs*) dizin sayfası, iletilerin eklenmesi, silinmesini ve ANALIZINI denetlemek için bir UI ve sayfa modeli yöntemleri sağlar (ileti başına ortalama sözcük).</span><span class="sxs-lookup"><span data-stu-id="b7c11-576">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (average words per message).</span></span>
* <span data-ttu-id="b7c11-577">Bir ileti, `Message` sınıfı (*Data/Message. cs*) ile iki özelliği olan ( `Id` anahtar) ve `Text` (ileti) açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-577">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="b7c11-578">`Text`Özelliği gereklidir ve 200 karakterle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-578">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="b7c11-579">İletiler, [Entity Framework bellek içi veritabanı](/ef/core/providers/in-memory/)&#8224; kullanılarak depolanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-579">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="b7c11-580">Uygulama, veritabanı bağlamı sınıfında ( `AppDbContext` *Data/AppDbContext. cs*) bir veri ERIŞIM katmanı (dal) içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-580">The app contains a data access layer (DAL) in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span>
* <span data-ttu-id="b7c11-581">Veritabanı uygulama başlangıcında boşsa, ileti deposu üç iletiyle başlatılır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-581">If the database is empty on app startup, the message store is initialized with three messages.</span></span>
* <span data-ttu-id="b7c11-582">Uygulama `/SecurePage` yalnızca kimliği doğrulanmış bir kullanıcı tarafından erişilebilen bir içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-582">The app includes a `/SecurePage` that can only be accessed by an authenticated user.</span></span>

<span data-ttu-id="b7c11-583">EF konusunda, [InMemory Ile Test](/ef/core/miscellaneous/testing/in-memory)&#8224;, MSTest ile testler için bellek içi bir veritabanının nasıl kullanılacağını açıklar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-583">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="b7c11-584">Bu konu [xUnit](https://xunit.github.io/) test çerçevesini kullanır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-584">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="b7c11-585">Farklı test çerçeveleri genelinde test kavramları ve test uygulamaları benzerdir ancak aynı değildir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-585">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="b7c11-586">Uygulama, depo desenini kullanmıyor ve [Iş birimi (UoW) düzeninin](https://martinfowler.com/eaaCatalog/unitOfWork.html)etkin bir örneği olmamasına karşın, Razor Sayfalar bu geliştirme düzenlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="b7c11-586">Although the app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="b7c11-587">Daha fazla bilgi için bkz. [altyapı Kalıcılık katmanını tasarlama](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) ve [Test denetleyicisi mantığı](/aspnet/core/mvc/controllers/testing) (örnek, depo modelini uygular).</span><span class="sxs-lookup"><span data-stu-id="b7c11-587">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and [Test controller logic](/aspnet/core/mvc/controllers/testing) (the sample implements the repository pattern).</span></span>

### <a name="test-app-organization"></a><span data-ttu-id="b7c11-588">Test uygulaması kuruluşu</span><span class="sxs-lookup"><span data-stu-id="b7c11-588">Test app organization</span></span>

<span data-ttu-id="b7c11-589">Test uygulaması, *testler/ Razor pagesproject. Tests* dizini içindeki bir konsol uygulamasıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-589">The test app is a console app inside the *tests/RazorPagesProject.Tests* directory.</span></span>

| <span data-ttu-id="b7c11-590">Uygulama dizinini test et</span><span class="sxs-lookup"><span data-stu-id="b7c11-590">Test app directory</span></span> | <span data-ttu-id="b7c11-591">Açıklama</span><span class="sxs-lookup"><span data-stu-id="b7c11-591">Description</span></span> |
| ------------------ | ----------- |
| <span data-ttu-id="b7c11-592">*AuthTests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-592">*AuthTests*</span></span> | <span data-ttu-id="b7c11-593">İçin test yöntemleri içerir:</span><span class="sxs-lookup"><span data-stu-id="b7c11-593">Contains test methods for:</span></span><ul><li><span data-ttu-id="b7c11-594">Güvenli bir sayfaya, kimliği doğrulanmamış bir kullanıcıyla erişme.</span><span class="sxs-lookup"><span data-stu-id="b7c11-594">Accessing a secure page by an unauthenticated user.</span></span></li><li><span data-ttu-id="b7c11-595">Bir sahte ile kimliği doğrulanmış bir kullanıcı tarafından güvenli bir sayfaya erişme <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1> .</span><span class="sxs-lookup"><span data-stu-id="b7c11-595">Accessing a secure page by an authenticated user with a mock <xref:Microsoft.AspNetCore.Authentication.AuthenticationHandler`1>.</span></span></li><li><span data-ttu-id="b7c11-596">GitHub kullanıcı profilini alma ve profilin Kullanıcı oturum açma bilgilerini denetleme.</span><span class="sxs-lookup"><span data-stu-id="b7c11-596">Obtaining a GitHub user profile and checking the profile's user login.</span></span></li></ul> |
| <span data-ttu-id="b7c11-597">*BasicTests*</span><span class="sxs-lookup"><span data-stu-id="b7c11-597">*BasicTests*</span></span> | <span data-ttu-id="b7c11-598">Yönlendirme ve içerik türü için bir test yöntemi içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-598">Contains a test method for routing and content type.</span></span> |
| <span data-ttu-id="b7c11-599">*Tümleştirme Testleri*</span><span class="sxs-lookup"><span data-stu-id="b7c11-599">*IntegrationTests*</span></span> | <span data-ttu-id="b7c11-600">Özel sınıf kullanan dizin sayfası için tümleştirme testlerini içerir `WebApplicationFactory` .</span><span class="sxs-lookup"><span data-stu-id="b7c11-600">Contains the integration tests for the Index page using custom `WebApplicationFactory` class.</span></span> |
| <span data-ttu-id="b7c11-601">*Yardımcılar/yardımcı programlar*</span><span class="sxs-lookup"><span data-stu-id="b7c11-601">*Helpers/Utilities*</span></span> | <ul><li><span data-ttu-id="b7c11-602">*Utilities.cs* , `InitializeDbForTests` veritabanını test verileriyle tohum için kullanılan yöntemi içerir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-602">*Utilities.cs* contains the `InitializeDbForTests` method used to seed the database with test data.</span></span></li><li><span data-ttu-id="b7c11-603">*HtmlHelpers.cs* `IHtmlDocument` , test yöntemleri tarafından kullanılmak üzere anglesharp döndüren bir yöntem sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-603">*HtmlHelpers.cs* provides a method to return an AngleSharp `IHtmlDocument` for use by the test methods.</span></span></li><li><span data-ttu-id="b7c11-604">*HttpClientExtensions.cs* `SendAsync` , istekleri sut 'a göndermek için için aşırı yüklemeler sağlar.</span><span class="sxs-lookup"><span data-stu-id="b7c11-604">*HttpClientExtensions.cs* provide overloads for `SendAsync` to submit requests to the SUT.</span></span></li></ul> |

<span data-ttu-id="b7c11-605">Test çerçevesi [xUnit](https://xunit.github.io/)' dir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-605">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="b7c11-606">Tümleştirme testleri, [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver)içeren [Microsoft. Aspnetcore. testhost](/dotnet/api/microsoft.aspnetcore.testhost)kullanılarak yürütülür.</span><span class="sxs-lookup"><span data-stu-id="b7c11-606">Integration tests are conducted using the [Microsoft.AspNetCore.TestHost](/dotnet/api/microsoft.aspnetcore.testhost), which includes the [TestServer](/dotnet/api/microsoft.aspnetcore.testhost.testserver).</span></span> <span data-ttu-id="b7c11-607">Test ana bilgisayarı ve test sunucusunu yapılandırmak için [Microsoft. AspNetCore. Mvc. Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) paketi kullanıldığından, ve paketleri test uygulamasındaki `TestHost` `TestServer` Proje dosyasında veya geliştirici yapılandırmasında doğrudan paket başvuruları gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="b7c11-607">Because the [Microsoft.AspNetCore.Mvc.Testing](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Testing) package is used to configure the test host and test server, the `TestHost` and `TestServer` packages don't require direct package references in the test app's project file or developer configuration in the test app.</span></span>

<span data-ttu-id="b7c11-608">**Test için veritabanının temelini sağlama**</span><span class="sxs-lookup"><span data-stu-id="b7c11-608">**Seeding the database for testing**</span></span>

<span data-ttu-id="b7c11-609">Tümleştirme testleri genellikle veritabanında test yürütmeden önce küçük bir veri kümesi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="b7c11-609">Integration tests usually require a small dataset in the database prior to the test execution.</span></span> <span data-ttu-id="b7c11-610">Örneğin, veritabanı kaydı silme için bir silme testi çağrılarında, silme isteğinin başarılı olması için veritabanının en az bir kaydı olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="b7c11-610">For example, a delete test calls for a database record deletion, so the database must have at least one record for the delete request to succeed.</span></span>

<span data-ttu-id="b7c11-611">Örnek uygulama, *Utilities.cs* içinde testlerin, yürütme sırasında kullanabileceği üç iletiyle birlikte veritabanını kullanır:</span><span class="sxs-lookup"><span data-stu-id="b7c11-611">The sample app seeds the database with three messages in *Utilities.cs* that tests can use when they execute:</span></span>

[!code-csharp[](integration-tests/samples/2.x/IntegrationTestsSample/tests/RazorPagesProject.Tests/Helpers/Utilities.cs?name=snippet1)]

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="b7c11-612">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="b7c11-612">Additional resources</span></span>

* [<span data-ttu-id="b7c11-613">Birim testleri</span><span class="sxs-lookup"><span data-stu-id="b7c11-613">Unit tests</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:test/razor-pages-tests>
* <xref:fundamentals/middleware/index>
* <xref:mvc/controllers/testing>
